import{e as W,f as h,N as F,S as Y,c as d,a as s,p as _,d as r,g as l,s as M,F as b,q as S,Z as o,n as g,j as p,w,a4 as $,cb as m,k as f,l as ss,a1 as ts,o as n}from"./index-DA11XDlS.js";import{B as es}from"./building-CB1-_eLG.js";import{T as as}from"./trophy-B8Qqs7MA.js";import{Z as os}from"./zap-vMqaBpWc.js";import{R as E}from"./refresh-cw-5h0-qbhL.js";import{U as rs}from"./user-CXIJJnqr.js";import{C as P}from"./coins-Ks2rpWqM.js";import{S as R}from"./sparkles-tsZM6BNv.js";import{c as ls}from"./createLucideIcon-DiiZaxVK.js";import{S as V}from"./swords-bfqjVPqN.js";import{L as is}from"./log-out-DPfR_OdR.js";import{C as ns}from"./circle-check-big-B5OYv702.js";import{C as ds}from"./circle-x-B-Ydbwdk.js";import{S as cs}from"./shield-BMlq6Nq0.js";import{C as us}from"./clock-Bnzg_83l.js";import{F as vs}from"./flame-DuW_991e.js";import{H as _s}from"./heart-LgXo-eep.js";import{G as ps}from"./gift-BEOm1WG9.js";import{C as I}from"./crown-CTywvOnR.js";import{S as ms}from"./star-D9p6u3Oh.js";import{u as hs}from"./use-message--i6DiThE.js";import{N as fs,b as ys}from"./Tabs-CdCqfdBl.js";import{_ as bs}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Add-C6IKdIGC.js";import"./use-compitable-BnEdbODL.js";import"./use-merged-state-DvdMjKiF.js";const gs=ls("log-in",[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]]),ws={class:"tower-page"},ks={class:"page-header"},xs={class:"header-icon"},zs={class:"tower-visual"},Cs={class:"tower-structure"},Fs={class:"tower-body"},Ss={class:"floor-markers"},Rs={class:"tower-stats"},Ls={class:"stat-main"},Ns={class:"stat-value"},Ts={class:"stat-sub"},Ds={class:"stat-row"},As={class:"stat-row"},Bs={class:"stat-row"},Ms={key:0,class:"floor-info"},Es={class:"floor-info-header"},Ps={class:"floor-name"},Vs={class:"floor-info-body"},Is={class:"guardian-card"},Hs={class:"guardian-detail"},Us={class:"guardian-name"},Zs={class:"guardian-power"},js={class:"floor-rewards"},Gs={class:"reward-items"},qs={class:"reward"},Os={class:"reward"},Xs={class:"action-buttons"},Js=["disabled"],Ks=["disabled"],Qs=["disabled"],Ws={key:1,class:"reset-section"},Ys=["disabled"],$s={key:0,class:"reset-cost"},st={class:"reset-hint"},tt={class:"result-banner"},et={class:"result-icon-wrap"},at={class:"result-title"},ot={class:"result-subtitle"},rt={class:"battle-versus"},lt={class:"versus-side player"},it={class:"side-icon"},nt={class:"versus-side guardian"},dt={class:"side-label"},ct={class:"side-icon"},ut={class:"battle-stats"},vt={class:"stats-grid"},_t={class:"stat-card"},pt={class:"stat-icon"},mt={class:"stat-info"},ht={class:"stat-value"},ft={class:"stat-card dealt"},yt={class:"stat-icon"},bt={class:"stat-info"},gt={class:"stat-value"},wt={class:"stat-card taken"},kt={class:"stat-icon"},xt={class:"stat-info"},zt={class:"stat-value"},Ct={key:0,class:"battle-rewards"},Ft={class:"rewards-header"},St={class:"rewards-content"},Rt={class:"reward-chip"},Lt={class:"reward-chip"},Nt={key:0,class:"special-badges"},Tt={key:0,class:"achievement-badge server-first"},Dt={key:1,class:"achievement-badge first-clear"},At={key:1,class:"breakthrough-notice"},Bt={class:"breakthrough-icon"},Mt={class:"breakthrough-text"},Et={class:"breakthrough-realm"},Pt={key:2,class:"defeat-hint"},Vt={class:"ranking-list"},It={key:0,class:"empty"},Ht={class:"rank-info"},Ut={class:"rank-name"},Zt={class:"rank-floor"},jt={class:"firsts-list"},Gt={key:0,class:"empty"},qt={class:"first-floor"},Ot={class:"first-info"},Xt={class:"first-name"},Jt={class:"first-time"},Kt=W({__name:"Tower",setup(Qt){const v=hs(),a=h(null),k=h([]),x=h([]),c=h(!1),y=h(!1),i=h(null),L=F(()=>a.value?a.value.dailyAttempts<a.value.maxDailyAttempts+a.value.dailyResets:!1),N=F(()=>{if(!a.value)return!1;const e=a.value.maxDailyAttempts+a.value.dailyResets;return!a.value.inTower&&a.value.dailyResets<a.value.maxDailyResets&&a.value.dailyAttempts>=e}),H=F(()=>{const e=a.value?.currentFloor||0;return Math.min(e/100*100,100)}),T=e=>{switch(e){case"boss":return"首领层";case"elite":return"精英层";default:return"普通层"}},U=e=>e===1?"gold":e===2?"silver":e===3?"bronze":"",Z=e=>new Date(e).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),D=e=>e?e>=1e4?(e/1e4).toFixed(1)+"万":e.toLocaleString():"0",z=async()=>{try{const e=await m.getStatus();a.value=e.data}catch(e){v.error(f(e,"获取状态失败"))}},j=async()=>{try{const e=await m.getRanking(20);k.value=e.data}catch(e){console.error("获取排行失败",e)}},G=async()=>{try{const e=await m.getServerFirsts();x.value=e.data}catch(e){console.error("获取首杀记录失败",e)}},q=async()=>{if(!(!L.value||c.value)){c.value=!0;try{const e=await m.enter();i.value=e.data,y.value=!0,e.data.victory?v.success("成功击败守卫！"):v.warning("挑战失败，被逐出古塔"),await C()}catch(e){v.error(f(e,"进入古塔失败"))}finally{c.value=!1}}},O=async()=>{if(!c.value){c.value=!0;try{const e=await m.continue();i.value=e.data,y.value=!0,e.data.victory?v.success("成功击败守卫！"):v.warning("挑战失败，被逐出古塔"),await C()}catch(e){v.error(f(e,"闯塔失败"))}finally{c.value=!1}}},X=async()=>{if(!c.value){c.value=!0;try{await m.exit(),v.success("已退出古塔"),await z()}catch(e){v.error(f(e,"退出失败"))}finally{c.value=!1}}},J=async()=>{if(!(!N.value||c.value)){c.value=!0;try{await m.reset(),v.success("古塔已重置"),await z()}catch(e){v.error(f(e,"重置失败"))}finally{c.value=!1}}},C=async()=>{await Promise.all([z(),j(),G()])};return Y(()=>{C()}),(e,t)=>{const K=$,A=ys,Q=fs;return n(),d("div",ws,[t[21]||(t[21]=s("div",{class:"tower-bg-decor"},[s("div",{class:"rune rune-1"},"符"),s("div",{class:"rune rune-2"},"塔"),s("div",{class:"rune rune-3"},"镇")],-1)),s("div",ks,[s("div",xs,[r(l(es),{size:24})]),t[1]||(t[1]=s("div",{class:"header-info"},[s("h2",null,"试炼古塔"),s("p",null,"通天古塔，挑战强大守卫")],-1))]),s("div",zs,[s("div",Cs,[t[2]||(t[2]=s("div",{class:"tower-top"},[s("div",{class:"tower-peak"})],-1)),s("div",Fs,[s("div",{class:"tower-progress",style:M({height:H.value+"%"})},null,4),s("div",Ss,[(n(),d(b,null,S([100,50,10],u=>s("div",{key:u,class:"floor-marker",style:M({bottom:u+"%"})},[s("span",null,o(u)+"层",1)],4)),64))])]),t[3]||(t[3]=s("div",{class:"tower-base"},null,-1))]),s("div",Rs,[s("div",Ls,[s("span",Ns,o(a.value?.currentFloor||0),1),t[4]||(t[4]=s("span",{class:"stat-label"},"当前层",-1))]),t[5]||(t[5]=s("div",{class:"stat-divider"},null,-1)),s("div",Ts,[s("div",Ds,[r(l(as),{size:14}),s("span",null,"最高 "+o(a.value?.bestFloor||0)+" 层",1)]),s("div",As,[r(l(os),{size:14}),s("span",null,"挑战 "+o(a.value?.dailyAttempts||0)+"/"+o(a.value?.maxDailyAttempts||1),1)]),s("div",Bs,[r(l(E),{size:14}),s("span",null,"重置 "+o(a.value?.dailyResets||0)+"/"+o(a.value?.maxDailyResets||3),1)])])])]),a.value?.inTower&&a.value?.nextFloor?(n(),d("div",Ms,[s("div",Es,[s("div",{class:g(["floor-badge",a.value.nextFloor.type])},o(T(a.value.nextFloor.type)),3),s("span",Ps,o(a.value.nextFloor.name),1)]),s("div",Vs,[s("div",Is,[r(l(rs),{size:20}),s("div",Hs,[s("span",Us,o(a.value.nextFloor.guardianName),1),s("span",Zs,"战力 "+o(a.value.nextFloor.estimatedPower?.toLocaleString()),1)])]),s("div",js,[t[6]||(t[6]=s("span",{class:"rewards-label"},"通关奖励",-1)),s("div",Gs,[s("span",qs,[r(l(P),{size:14}),p(" "+o(a.value.nextFloor.rewards?.spiritStones),1)]),s("span",Os,[r(l(R),{size:14}),p(" "+o(a.value.nextFloor.rewards?.experience),1)])])])])])):_("",!0),s("div",Xs,[a.value?.inTower?(n(),d(b,{key:1},[s("button",{class:"action-btn continue",disabled:c.value,onClick:O},[r(l(V),{size:18}),p(" "+o(c.value?"挑战中...":"继续闯塔"),1)],8,Ks),s("button",{class:"action-btn exit",disabled:c.value,onClick:X},[r(l(is),{size:18}),t[7]||(t[7]=p(" 退出 ",-1))],8,Qs)],64)):(n(),d("button",{key:0,class:"action-btn enter",disabled:!L.value,onClick:q},[r(l(gs),{size:18}),p(" "+o(c.value?"进入中...":"进入古塔"),1)],8,Js))]),a.value?.bestFloor&&a.value.bestFloor>0?(n(),d("div",Ws,[s("button",{class:"reset-btn",disabled:!N.value,onClick:J},[r(l(E),{size:16}),t[8]||(t[8]=p(" 重置古塔 ",-1)),a.value?.resetCost?(n(),d("span",$s,"("+o(a.value.resetCost.toLocaleString())+" 修为)",1)):_("",!0)],8,Ys),s("p",st,o(a.value?.inTower?"塔中无法重置":a.value?.dailyResets>=a.value?.maxDailyResets?"今日重置次数已用尽":"重置后从第1层开始"),1)])):_("",!0),r(K,{show:y.value,"onUpdate:show":t[0]||(t[0]=u=>y.value=u),preset:"card",title:null,style:{"max-width":"400px"},bordered:!1},{default:w(()=>[s("div",{class:g(["battle-result",i.value?.victory?"victory":"defeat"])},[s("div",tt,[s("div",et,[(n(),ss(ts(i.value?.victory?l(ns):l(ds)),{size:56}))]),s("div",at,o(i.value?.victory?"挑战成功":"挑战失败"),1),s("div",ot,[s("span",{class:g(["floor-badge-mini",i.value?.floor?.type])},o(T(i.value?.floor?.type||"normal")),3),p(" "+o(i.value?.floor?.name),1)])]),s("div",rt,[s("div",lt,[t[9]||(t[9]=s("span",{class:"side-label"},"玩家",-1)),s("span",it,[r(l(V),{size:24})])]),t[10]||(t[10]=s("div",{class:"versus-center"},"VS",-1)),s("div",nt,[s("span",dt,o(i.value?.floor?.guardianName),1),s("span",ct,[r(l(cs),{size:24})])])]),s("div",ut,[s("div",vt,[s("div",_t,[s("div",pt,[r(l(us),{size:20})]),s("div",mt,[s("span",ht,o(i.value?.battleLog?.rounds||0),1),t[11]||(t[11]=s("span",{class:"stat-label"},"回合",-1))])]),s("div",ft,[s("div",yt,[r(l(vs),{size:20})]),s("div",bt,[s("span",gt,o(D(i.value?.battleLog?.playerDamage)),1),t[12]||(t[12]=s("span",{class:"stat-label"},"造成伤害",-1))])]),s("div",wt,[s("div",kt,[r(l(_s),{size:20})]),s("div",xt,[s("span",zt,o(D(i.value?.battleLog?.guardianDamage)),1),t[13]||(t[13]=s("span",{class:"stat-label"},"承受伤害",-1))])])])]),i.value?.victory&&i.value?.rewards?(n(),d("div",Ct,[s("div",Ft,[r(l(ps),{size:18}),t[14]||(t[14]=s("span",null,"战利品",-1))]),s("div",St,[s("div",Rt,[r(l(P),{size:16}),s("span",null,o(i.value.rewards.spiritStones?.toLocaleString()),1),t[15]||(t[15]=s("span",{class:"reward-name"},"灵石",-1))]),s("div",Lt,[r(l(R),{size:16}),s("span",null,o(i.value.rewards.experience?.toLocaleString()),1),t[16]||(t[16]=s("span",{class:"reward-name"},"修为",-1))])]),i.value.isFirstClear||i.value.isServerFirst?(n(),d("div",Nt,[i.value.isServerFirst?(n(),d("div",Tt,[r(l(I),{size:16}),t[17]||(t[17]=s("span",null,"全服首杀",-1))])):i.value.isFirstClear?(n(),d("div",Dt,[r(l(ms),{size:16}),t[18]||(t[18]=s("span",null,"首次通关",-1))])):_("",!0)])):_("",!0)])):_("",!0),i.value?.breakthrough?(n(),d("div",At,[s("div",Bt,[r(l(R),{size:20})]),s("div",Mt,[t[19]||(t[19]=s("span",{class:"breakthrough-title"},"境界突破",-1)),s("span",Et,o(i.value.breakthrough.newRealmName),1)])])):_("",!0),i.value?.victory?_("",!0):(n(),d("div",Pt,[...t[20]||(t[20]=[s("span",null,"被逐出古塔，下次再战！",-1)])]))],2)]),_:1},8,["show"]),r(Q,{type:"line",animated:"",class:"info-tabs"},{default:w(()=>[r(A,{name:"ranking",tab:"琉璃塔榜"},{default:w(()=>[s("div",Vt,[k.value.length===0?(n(),d("div",It,"暂无排名数据")):_("",!0),(n(!0),d(b,null,S(k.value,(u,B)=>(n(),d("div",{key:u.characterId,class:"ranking-item"},[s("div",{class:g(["rank-pos",U(B+1)])},o(B+1),3),s("div",Ht,[s("span",Ut,o(u.characterName),1),s("span",Zt,"最高 "+o(u.bestFloor)+" 层",1)])]))),128))])]),_:1}),r(A,{name:"firsts",tab:"全服首杀"},{default:w(()=>[s("div",jt,[x.value.length===0?(n(),d("div",Gt,"暂无首杀记录")):_("",!0),(n(!0),d(b,null,S(x.value,u=>(n(),d("div",{key:u.floor,class:"first-item"},[s("div",qt,[r(l(I),{size:14}),p(" 第"+o(u.floor)+"层 ",1)]),s("div",Ot,[s("span",Xt,o(u.characterName),1),s("span",Jt,o(Z(u.clearedAt)),1)])]))),128))])]),_:1})]),_:1})])}}}),xe=bs(Kt,[["__scopeId","data-v-921f22ef"]]);export{xe as default};
