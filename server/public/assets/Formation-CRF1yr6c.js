import{e as R,f as $,S as x,a0 as B,c as s,a as t,p as f,d as n,g as r,Z as i,j as l,F,q as C,c9 as _,k as u,n as M,o as a}from"./index-DA11XDlS.js";import{S as L}from"./shield-BMlq6Nq0.js";import{S as V}from"./shield-check-fOgaozYJ.js";import{S as p,U as k,G as q}from"./undo-2-rKn3xdOe.js";import{W as g}from"./wind-DSFUGIbd.js";import{Z as y}from"./zap-vMqaBpWc.js";import{T as I}from"./timer-C2OaA_iH.js";import{C as U}from"./circle-x-B-Ydbwdk.js";import{B as Z}from"./book-open-B-z3oi1Q.js";import{C as z}from"./coins-Ks2rpWqM.js";import{S as E}from"./sparkles-tsZM6BNv.js";import{u as G}from"./use-message--i6DiThE.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createLucideIcon-DiiZaxVK.js";const j={class:"formation-page"},H={class:"page-header"},O={class:"header-icon"},X={key:0,class:"active-formation"},J={class:"active-header"},K={class:"active-card"},P={class:"formation-name"},Q={class:"formation-tier"},Y={class:"formation-effects"},ee={key:0,class:"effect-item"},te={key:1,class:"effect-item"},se={key:2,class:"effect-item"},ae={key:3,class:"effect-item"},ie={class:"remaining-time"},ce={class:"section"},oe={key:0,class:"empty-section"},ne={key:1,class:"formation-list"},re={class:"card-header"},de={class:"formation-name"},le={class:"formation-tier"},fe={class:"formation-desc"},me={class:"formation-effects"},ve={key:0,class:"effect-item"},_e={key:1,class:"effect-item"},ue={key:2,class:"effect-item"},he={key:3,class:"effect-item"},pe={class:"card-footer"},ke={class:"activation-cost"},ge=["onClick"],ye={key:1,class:"cannot-activate"},Fe={class:"section"},Ce={key:0,class:"empty-section"},ze={key:1,class:"formation-list"},Se={class:"card-header"},be={class:"formation-name"},Ae={class:"formation-tier"},Ne={class:"formation-desc"},Te={class:"formation-effects"},we={key:0,class:"effect-item"},De={key:1,class:"effect-item"},Re={key:2,class:"effect-item"},$e={key:3,class:"effect-item"},xe={class:"card-footer"},Be={class:"learn-cost"},Me=["onClick"],Le={key:1,class:"realm-requirement"},Ve=R({__name:"Formation",setup(qe){const m=G(),c=$(null),S=["炼气期","筑基期","结丹期","元婴期","化神期","炼虚期","合体期","大乘期","渡劫期"],b=d=>S[d-1]||`${d}阶`,A=d=>{if(d<=0)return"已过期";const o=Math.floor(d/(1e3*60*60)),e=Math.floor(d%(1e3*60*60)/(1e3*60));return o>0?`${o}小时${e}分`:`${e}分钟`},v=async()=>{try{const d=await _.getStatus();c.value=d.data}catch(d){m.error(u(d,"获取阵法状态失败"))}},N=async d=>{try{const o=await _.learn(d);m.success(o.data.message),await v()}catch(o){m.error(u(o,"学习失败"))}},T=async d=>{try{const o=await _.activate(d);m.success(o.data.message),await v()}catch(o){m.error(u(o,"激活失败"))}},w=async()=>{try{const d=await _.deactivate();m.success(d.data.message),await v()}catch(d){m.error(u(d,"撤阵失败"))}};let h=null;return x(async()=>{await v(),h=setInterval(()=>{c.value?.activeFormation&&c.value.activeFormation.remainingTime>0&&(c.value.activeFormation.remainingTime-=1e3,c.value.activeFormation.remainingTime<=0&&v())},1e3)}),B(()=>{h&&clearInterval(h)}),(d,o)=>(a(),s("div",j,[t("div",H,[t("div",O,[n(r(L),{size:24})]),o[0]||(o[0]=t("div",{class:"header-info"},[t("h2",null,"洞府阵法"),t("p",null,"布置防护阵法，抵御来犯之敌")],-1))]),c.value?.activeFormation?(a(),s("div",X,[t("div",J,[n(r(V),{size:18}),o[1]||(o[1]=t("span",null,"当前防护",-1))]),t("div",K,[t("div",P,i(c.value.activeFormation.name),1),t("div",Q,i(c.value.activeFormation.tierName),1),t("div",Y,[c.value.activeFormation.effects.damageReduction?(a(),s("div",ee,[n(r(p),{size:14}),t("span",null,"减伤 "+i(c.value.activeFormation.effects.damageReduction)+"%",1)])):f("",!0),c.value.activeFormation.effects.reflectDamage?(a(),s("div",te,[n(r(k),{size:14}),t("span",null,"反伤 "+i(c.value.activeFormation.effects.reflectDamage)+"%",1)])):f("",!0),c.value.activeFormation.effects.dodgeChance?(a(),s("div",se,[n(r(g),{size:14}),t("span",null,"闪避 "+i(c.value.activeFormation.effects.dodgeChance)+"%",1)])):f("",!0),c.value.activeFormation.effects.counterAttack?(a(),s("div",ae,[n(r(y),{size:14}),t("span",null,"反击 "+i(c.value.activeFormation.effects.counterAttack)+"%",1)])):f("",!0)]),t("div",ie,[n(r(I),{size:14}),t("span",null,"剩余 "+i(A(c.value.activeFormation.remainingTime)),1)]),t("button",{class:"deactivate-btn",onClick:w},[n(r(U),{size:16}),o[2]||(o[2]=l(" 撤阵 ",-1))])])])):f("",!0),t("div",ce,[t("h3",null,[n(r(Z),{size:18}),o[3]||(o[3]=l(" 已习阵法 ",-1))]),c.value?.learnedFormations?.length?(a(),s("div",ne,[(a(!0),s(F,null,C(c.value.learnedFormations,e=>(a(),s("div",{key:e.id,class:"formation-card learned"},[t("div",re,[t("span",de,i(e.name),1),t("span",le,i(e.tierName),1)]),t("p",fe,i(e.description),1),t("div",me,[e.effects.damageReduction?(a(),s("div",ve,[n(r(p),{size:12}),l(" "+i(e.effects.damageReduction)+"% ",1)])):f("",!0),e.effects.reflectDamage?(a(),s("div",_e,[n(r(k),{size:12}),l(" "+i(e.effects.reflectDamage)+"% ",1)])):f("",!0),e.effects.dodgeChance?(a(),s("div",ue,[n(r(g),{size:12}),l(" "+i(e.effects.dodgeChance)+"% ",1)])):f("",!0),e.effects.counterAttack?(a(),s("div",he,[n(r(y),{size:12}),l(" "+i(e.effects.counterAttack)+"% ",1)])):f("",!0)]),t("div",pe,[t("div",ke,[n(r(z),{size:12}),l(" "+i(e.activationCost.spiritStones)+" ",1),n(r(E),{size:12,class:"ml-2"}),l(" "+i(e.activationCost.cultivation),1)]),e.canActivate?(a(),s("button",{key:0,class:"activate-btn",onClick:D=>T(e.id)},"布阵",8,ge)):(a(),s("span",ye,"已激活其他阵法"))])]))),128))])):(a(),s("div",oe,"尚未习得任何阵法"))]),t("div",Fe,[t("h3",null,[n(r(q),{size:18}),o[4]||(o[4]=l(" 可习阵法 ",-1))]),c.value?.availableFormations?.length?(a(),s("div",ze,[(a(!0),s(F,null,C(c.value.availableFormations,e=>(a(),s("div",{key:e.id,class:M(["formation-card available",{"can-learn":e.canLearn}])},[t("div",Se,[t("span",be,i(e.name),1),t("span",Ae,i(e.tierName),1)]),t("p",Ne,i(e.description),1),t("div",Te,[e.effects.damageReduction?(a(),s("div",we,[n(r(p),{size:12}),l(" "+i(e.effects.damageReduction)+"% ",1)])):f("",!0),e.effects.reflectDamage?(a(),s("div",De,[n(r(k),{size:12}),l(" "+i(e.effects.reflectDamage)+"% ",1)])):f("",!0),e.effects.dodgeChance?(a(),s("div",Re,[n(r(g),{size:12}),l(" "+i(e.effects.dodgeChance)+"% ",1)])):f("",!0),e.effects.counterAttack?(a(),s("div",$e,[n(r(y),{size:12}),l(" "+i(e.effects.counterAttack)+"% ",1)])):f("",!0)]),t("div",xe,[t("div",Be,[n(r(z),{size:12}),l(" "+i(e.learnCost.spiritStones),1)]),e.canLearn?(a(),s("button",{key:0,class:"learn-btn",onClick:D=>N(e.id)},"习得",8,Me)):(a(),s("span",Le,"需 "+i(b(e.requiredRealmTier)),1))])],2))),128))])):(a(),s("div",Ce,"暂无可学习的阵法"))])]))}}),Ye=W(Ve,[["__scopeId","data-v-5fd91dbf"]]);export{Ye as default};
