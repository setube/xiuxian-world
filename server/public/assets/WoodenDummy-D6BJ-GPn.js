import{e as U,f as c,N as h,S as W,a0 as j,c as i,a as s,p as D,d as u,g as d,Z as o,F as k,q as b,j as S,w as q,a4 as X,c8 as R,k as x,n as p,l as Z,a1 as G,o as r}from"./index-DA11XDlS.js";import{C as L}from"./circle-check-big-B5OYv702.js";import{C as J}from"./circle-x-B-Ydbwdk.js";import{c as K}from"./createLucideIcon-DiiZaxVK.js";import{S as Q}from"./sword-BlVHvUf1.js";import{T as Y}from"./timer-C2OaA_iH.js";import{T as ss}from"./trophy-B8Qqs7MA.js";import{S as es}from"./swords-bfqjVPqN.js";import{H as ts}from"./history-F1M976CY.js";import{C as as}from"./coins-Ks2rpWqM.js";import{u as os}from"./use-message--i6DiThE.js";import{_ as ls}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ns=K("circle-minus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]),rs={class:"wooden-dummy-page"},is={class:"page-header"},cs={class:"header-icon"},us={class:"status-bar"},ds={class:"status-item"},ms={key:0,class:"ready"},vs={key:1,class:"cooldown"},_s={key:0,class:"status-item best-record"},hs={class:"today-stats"},ps={class:"stat-item"},ys={class:"stat-value"},fs={class:"stat-item win"},gs={class:"stat-value"},ws={class:"stat-item lose"},Cs={class:"stat-value"},ks={class:"stat-item draw"},bs={class:"stat-value"},Ss={class:"realm-selector"},Rs={class:"realm-grid"},xs=["onClick"],Ts={class:"realm-name"},zs={class:"realm-cost"},Ns={key:0,class:"sub-realm-selector"},Ds={class:"sub-realm-options"},Ls=["onClick"],Ms=["disabled"],Bs={class:"battle-result"},Is={class:"result-text"},Hs={class:"result-stats"},Ps={class:"stat-row"},Vs={class:"stat-row"},$s={class:"damage-dealt"},As={class:"stat-row"},Es={class:"damage-taken"},Fs={class:"stat-row"},Os={class:"history-section"},Us={key:0,class:"empty-history"},Ws={key:1,class:"history-list"},js={class:"history-info"},qs={class:"dummy-name"},Xs={class:"battle-time"},Zs={class:"history-result"},Gs={class:"result-badge"},Js={class:"rounds"},Ks=U({__name:"WoodenDummy",setup(Qs){const v=os(),l=c(null),y=c([]),m=c(1),f=c(2),_=c(!1),g=c(!1),n=c(null),M=[{tier:1,name:"炼气期",cost:10},{tier:2,name:"筑基期",cost:50},{tier:3,name:"结丹期",cost:200},{tier:4,name:"元婴期",cost:500},{tier:5,name:"化神期",cost:1e3},{tier:6,name:"炼虚期",cost:2e3},{tier:7,name:"合体期",cost:5e3},{tier:8,name:"大乘期",cost:1e4},{tier:9,name:"渡劫期",cost:2e4}],B=[{value:1,name:"初期"},{value:2,name:"中期"},{value:3,name:"后期"},{value:4,name:"圆满"}],T=h(()=>l.value?.canChallenge&&!_.value&&m.value),I=h(()=>n.value?n.value.result===1?"win":n.value.result===0?"lose":"draw":""),H=h(()=>n.value?n.value.result===1?"胜利":n.value.result===0?"失败":"平局":""),P=h(()=>n.value?n.value.result===1?L:n.value.result===0?J:ns:L),V=t=>{const e=Math.ceil(t/1e3),C=Math.floor(e/60),a=e%60;return`${C}:${a.toString().padStart(2,"0")}`},$=t=>new Date(t).toLocaleString("zh-CN",{hour:"2-digit",minute:"2-digit"}),A=t=>t===1?"win":t===0?"lose":"draw",E=t=>t===1?"胜":t===0?"败":"平",z=async()=>{try{const t=await R.getStatus();l.value=t.data}catch(t){v.error(x(t,"获取状态失败"))}},N=async()=>{try{const t=await R.getHistory(10);y.value=t.data}catch(t){v.error(x(t,"获取记录失败"))}},F=async()=>{if(T.value){_.value=!0;try{const t=await R.challenge(m.value,f.value);n.value=t.data,g.value=!0,v.success(t.data.message),await Promise.all([z(),N()])}catch(t){v.error(x(t,"挑战失败"))}finally{_.value=!1}}};let w=null;return W(async()=>{await Promise.all([z(),N()]),w=setInterval(()=>{l.value&&!l.value.canChallenge&&l.value.cooldownRemaining>0&&(l.value.cooldownRemaining-=1e3,l.value.cooldownRemaining<=0&&(l.value.canChallenge=!0,l.value.cooldownRemaining=0))},1e3)}),j(()=>{w&&clearInterval(w)}),(t,e)=>{const C=X;return r(),i("div",rs,[s("div",is,[s("div",cs,[u(d(Q),{size:24})]),e[1]||(e[1]=s("div",{class:"header-info"},[s("h2",null,"木人阁"),s("p",null,"与木人傀儡切磋，评估自身战力")],-1))]),s("div",us,[s("div",ds,[u(d(Y),{size:16}),l.value?.canChallenge?(r(),i("span",ms,"可挑战")):(r(),i("span",vs,"冷却中 "+o(V(l.value?.cooldownRemaining||0)),1))]),l.value?.bestRecord?(r(),i("div",_s,[u(d(ss),{size:16}),s("span",null,"最高击败："+o(l.value.bestRecord.dummyName),1)])):D("",!0)]),s("div",hs,[s("div",ps,[s("span",ys,o(l.value?.todayStats?.totalChallenges||0),1),e[2]||(e[2]=s("span",{class:"stat-label"},"今日挑战",-1))]),s("div",fs,[s("span",gs,o(l.value?.todayStats?.wins||0),1),e[3]||(e[3]=s("span",{class:"stat-label"},"胜利",-1))]),s("div",ws,[s("span",Cs,o(l.value?.todayStats?.losses||0),1),e[4]||(e[4]=s("span",{class:"stat-label"},"失败",-1))]),s("div",ks,[s("span",bs,o(l.value?.todayStats?.draws||0),1),e[5]||(e[5]=s("span",{class:"stat-label"},"平局",-1))])]),s("div",Ss,[e[6]||(e[6]=s("h3",null,"选择木人境界",-1)),s("div",Rs,[(r(),i(k,null,b(M,a=>s("div",{key:a.tier,class:p(["realm-card",{selected:m.value===a.tier}]),onClick:O=>m.value=a.tier},[s("div",Ts,o(a.name),1),s("div",zs,[u(d(as),{size:12}),S(" "+o(a.cost),1)])],10,xs)),64))])]),m.value?(r(),i("div",Ns,[e[7]||(e[7]=s("h4",null,"选择小境界",-1)),s("div",Ds,[(r(),i(k,null,b(B,a=>s("div",{key:a.value,class:p(["sub-realm-option",{selected:f.value===a.value}]),onClick:O=>f.value=a.value},o(a.name),11,Ls)),64))])])):D("",!0),s("button",{class:"challenge-btn",disabled:!T.value,onClick:F},[u(d(es),{size:18}),S(" "+o(_.value?"切磋中...":"开始切磋"),1)],8,Ms),u(C,{show:g.value,"onUpdate:show":e[0]||(e[0]=a=>g.value=a),preset:"card",title:"切磋结果",style:{"max-width":"400px"}},{default:q(()=>[s("div",Bs,[s("div",{class:p(["result-header",I.value])},[(r(),Z(G(P.value),{size:48})),s("span",Is,o(H.value),1)],2),s("div",Hs,[s("div",Ps,[e[8]||(e[8]=s("span",null,"战斗回合",-1)),s("span",null,o(n.value?.record?.roundsLasted||0)+" / "+o(n.value?.record?.totalRounds||50),1)]),s("div",Vs,[e[9]||(e[9]=s("span",null,"造成伤害",-1)),s("span",$s,o(n.value?.record?.damageDealt?.toLocaleString()||0),1)]),s("div",As,[e[10]||(e[10]=s("span",null,"承受伤害",-1)),s("span",Es,o(n.value?.record?.damageTaken?.toLocaleString()||0),1)]),s("div",Fs,[e[11]||(e[11]=s("span",null,"战力对比",-1)),s("span",null,o(n.value?.record?.characterPower||0)+" vs "+o(n.value?.record?.dummyPower||0),1)])])])]),_:1},8,["show"]),s("div",Os,[s("h3",null,[u(d(ts),{size:18}),e[12]||(e[12]=S(" 战斗记录 ",-1))]),y.value.length===0?(r(),i("div",Us,"暂无战斗记录")):(r(),i("div",Ws,[(r(!0),i(k,null,b(y.value,a=>(r(),i("div",{key:a.id,class:p(["history-item",A(a.result)])},[s("div",js,[s("span",qs,o(a.dummyName),1),s("span",Xs,o($(a.createdAt)),1)]),s("div",Zs,[s("span",Gs,o(E(a.result)),1),s("span",Js,o(a.roundsLasted)+"回合",1)])],2))),128))]))])])}}}),de=ls(Ks,[["__scopeId","data-v-220b99ad"]]);export{de as default};
