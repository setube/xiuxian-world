import{a2 as pe,f as M,N as x,cC as P,e as U,c as n,a as t,d as o,p as h,g as e,j as v,B as I,w as g,n as T,cx as ye,F as z,q as D,Z as d,s as V,o as a,l as N,S as ae,x as ve}from"./index-DA11XDlS.js";import{S as ge}from"./skull-BAbr3491.js";import{U as Q}from"./users-DzD0wEV-.js";import{S as _e}from"./star-D9p6u3Oh.js";import{M as Y,S as oe}from"./scroll-text-CzgMLmVM.js";import{P as fe}from"./plus-BY3P3rBe.js";import{c as B}from"./createLucideIcon-DiiZaxVK.js";import{R as ne}from"./refresh-cw-5h0-qbhL.js";import{G as ee}from"./ghost-ebrS4p_g.js";import{U as re}from"./user-plus-D5P68FjT.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as he}from"./crown-CTywvOnR.js";import{X as Z}from"./x-DGyACQy4.js";import{S as se}from"./swords-bfqjVPqN.js";import{C as le}from"./check-Dvn_Mgz0.js";import{F as ke}from"./flame-DuW_991e.js";import{G as we}from"./gift-BEOm1WG9.js";import{S as ie}from"./sparkles-tsZM6BNv.js";import{A as ue}from"./award-B0i9BiiK.js";import{P as Re}from"./package-CRVIogFf.js";import{C as be}from"./chevron-right-BzVHn-hR.js";import{u as ce}from"./use-message--i6DiThE.js";import{u as ze}from"./composables-BMk_yTOy.js";import{L as de}from"./loader-Bk8qWIrR.js";import{C as $e}from"./clock-Bnzg_83l.js";import{N as Se,b as X}from"./Tabs-CdCqfdBl.js";import"./Add-C6IKdIGC.js";import"./use-compitable-BnEdbODL.js";import"./use-merged-state-DvdMjKiF.js";const me=B("castle",[["path",{d:"M10 5V3",key:"1y54qe"}],["path",{d:"M14 5V3",key:"m6isi"}],["path",{d:"M15 21v-3a3 3 0 0 0-6 0v3",key:"lbp5hj"}],["path",{d:"M18 3v8",key:"2ollhf"}],["path",{d:"M18 5H6",key:"98imr9"}],["path",{d:"M22 11H2",key:"1lmjae"}],["path",{d:"M22 9v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9",key:"1rly83"}],["path",{d:"M6 3v8",key:"csox7g"}]]);const O=B("hexagon",[["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}]]);const Ce=B("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);const xe=B("route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);const Ie=B("snowflake",[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]]),q={pj:{name:"破军",description:"DPS核心，金系雷系神通攻伐无双",color:"#faad14"},ys:{name:"御山",description:"坦克，土系功法御敌护友",color:"#d48806"},ly:{name:"灵医",description:"治疗，木水系灵根可调动生机",color:"#52c41a"},zs:{name:"咒师",description:"DPS/Debuff，火系功法焚天灭敌",color:"#f5222d"},yr:{name:"影刃",description:"控制/DPS，风冰系神通迅捷难挡",color:"#13c2c2"}},Pe={metal_pure:"pj",thunder:"pj",metal_water:"pj",earth_pure:"ys",earth_metal:"ys",fire_earth:"ys",wood_pure:"ly",water_pure:"ly",water_wood:"ly",fire_pure:"zs",wood_fire:"zs",wind:"yr",ice:"yr",metal_water_wood:"pj",wood_fire_earth:"zs",water_fire_metal:"pj",four_elements:"zs",five_elements:"zs",mortal_root:"zs"},J=pe("dungeon",()=>{const F=M([]),s=M(null),u=M(null),k=M([]),f=M(!1),_=M(!1),$=x(()=>u.value?.inRoom??!1),p=x(()=>u.value?!u.value.inRoom&&u.value.xutianMapCount>0:!1),l=x(()=>{if(!s.value||!u.value?.currentRoomId)return!1;const m=localStorage.getItem("characterId");return s.value.leaderId===m}),w=x(()=>s.value?.members?.length??0),H=x(()=>w.value>=5),C=x(()=>!s.value||!l.value?!1:s.value.status==="waiting"&&H.value),y=x(()=>s.value?.status==="in_progress"),b=x(()=>s.value?.status==="completed"||s.value?.status==="failed"),R=async()=>{try{const{data:m}=await P.getRooms();return F.value=m.rooms||[],m}catch{return F.value=[],null}},j=async()=>{f.value=!0;try{const{data:m}=await P.getStatus();return u.value=m,m}finally{f.value=!1}},L=async m=>{try{const{data:S}=await P.getRoomDetail(m);return s.value=S,S}catch{return s.value=null,null}},G=async m=>{try{const{data:S}=await P.getHistory(m);return k.value=S.records||[],S}catch{return k.value=[],null}};return{rooms:F,currentRoom:s,status:u,history:k,loading:f,actionLoading:_,isInRoom:$,canCreateRoom:p,isLeader:l,memberCount:w,isRoomFull:H,canStart:C,isInProgress:y,isCompleted:b,fetchRooms:R,fetchStatus:j,fetchRoomDetail:L,fetchHistory:G,createRoom:async(m="xutian_demon")=>{_.value=!0;try{const{data:S}=await P.createRoom(m);return await Promise.all([j(),R()]),S.roomId&&await L(S.roomId),S}finally{_.value=!1}},joinRoom:async m=>{_.value=!0;try{const{data:S}=await P.joinRoom(m);return await Promise.all([j(),R()]),await L(m),S}finally{_.value=!1}},leaveRoom:async()=>{if(s.value){_.value=!0;try{const{data:m}=await P.leaveRoom(s.value.id);return s.value=null,await Promise.all([j(),R()]),m}finally{_.value=!1}}},kickMember:async m=>{if(s.value){_.value=!0;try{const{data:S}=await P.kickMember(s.value.id,m);return await L(s.value.id),S}finally{_.value=!1}}},disbandRoom:async()=>{if(s.value){_.value=!0;try{const{data:m}=await P.disbandRoom(s.value.id);return s.value=null,await Promise.all([j(),R()]),m}finally{_.value=!1}}},startDungeon:async()=>{if(s.value){_.value=!0;try{const{data:m}=await P.startDungeon(s.value.id);return await L(s.value.id),m}finally{_.value=!1}}},selectPath:async m=>{if(s.value){_.value=!0;try{const{data:S}=await P.selectPath(s.value.id,m);return await L(s.value.id),S}finally{_.value=!1}}},nextStage:async()=>{if(s.value){_.value=!0;try{const{data:m}=await P.nextStage(s.value.id);return await L(s.value.id),m.dungeonEnded&&await Promise.all([j(),G()]),{stageResult:m}}finally{_.value=!1}}},initialize:async()=>{await j(),u.value?.currentRoomId&&await L(u.value.currentRoomId),await R()},clear:()=>{F.value=[],s.value=null,u.value=null,k.value=[]},getRoleInfo:m=>q[m]||{name:"未知",description:"",color:"#888"},getRoleFromSpiritRoot:m=>Pe[m]||"zs"}}),Le={class:"room-list-panel"},Me={class:"create-section"},De={class:"dungeon-intro"},Ne={class:"intro-icon"},je={class:"intro-content"},Te={class:"intro-requirements"},Fe={key:0,class:"cannot-create-reason"},He={key:1,class:"cannot-create-reason"},Ae={class:"room-list"},qe={class:"list-header"},Ve={key:0,class:"empty-list"},Be={class:"room-info"},Ge={class:"room-header"},Oe={class:"room-name"},Ue={class:"room-members"},Ee={class:"member-slots"},Je=["title"],Ke={class:"member-count"},We=U({__name:"RoomListPanel",emits:["join","create"],setup(F,{emit:s}){const u=s,k=J(),f=M(!1),_=M(null),$=x(()=>k.rooms.filter(C=>C.status==="waiting")),p=C=>q[C]?.name||"未知",l=C=>q[C]?.color||"#888",w=async()=>{f.value=!0;try{await k.fetchRooms()}finally{f.value=!1}},H=async C=>{_.value=C;try{u("join",C)}finally{_.value=null}};return(C,y)=>(a(),n("div",Le,[t("div",Me,[t("div",De,[t("div",Ne,[o(e(ge),{size:32})]),t("div",je,[y[4]||(y[4]=t("h3",null,"虚天殿·降魔",-1)),y[5]||(y[5]=t("p",null,"上古秘境虚天殿，蛮胡子道人盘踞于此。需5人金丹期以上修士组队挑战。",-1)),t("div",Te,[t("span",null,[o(e(Q),{size:12}),y[1]||(y[1]=v(" 5人组队 ",-1))]),t("span",null,[o(e(_e),{size:12}),y[2]||(y[2]=v(" 金丹初期+ ",-1))]),t("span",null,[o(e(Y),{size:12}),y[3]||(y[3]=v(" 消耗虚天残图×1 ",-1))])])])]),o(e(I),{type:"primary",size:"large",disabled:!e(k).canCreateRoom,loading:e(k).actionLoading,onClick:y[0]||(y[0]=b=>u("create"))},{icon:g(()=>[o(e(fe),{size:18})]),default:g(()=>[y[6]||(y[6]=v(" 创建房间 ",-1))]),_:1},8,["disabled","loading"]),e(k).isInRoom?(a(),n("p",Fe,"你已在房间中")):e(k).status?.xutianMapCount?h("",!0):(a(),n("p",He," 需要虚天残图才能创建房间（闭关修炼时有极小概率获得） "))]),t("div",Ae,[t("div",qe,[t("h3",null,[o(e(me),{size:16}),y[7]||(y[7]=v(" 可加入的房间 ",-1))]),o(e(I),{quaternary:"",size:"small",loading:f.value,onClick:w},{icon:g(()=>[o(e(ne),{size:14,class:T({spinning:f.value})},null,8,["class"])]),default:g(()=>[y[8]||(y[8]=v(" 刷新 ",-1))]),_:1},8,["loading"])]),$.value.length===0?(a(),n("div",Ve,[o(e(ee),{size:48}),y[9]||(y[9]=t("p",null,"暂无可加入的房间",-1)),y[10]||(y[10]=t("span",null,"创建一个房间，召集同道共探秘境",-1))])):h("",!0),o(ye,{name:"room",tag:"div",class:"room-items"},{default:g(()=>[(a(!0),n(z,null,D($.value,b=>(a(),n("div",{key:b.id,class:"room-card"},[t("div",Be,[t("div",Ge,[t("span",Oe,d(b.leaderName)+"的队伍",1),t("span",{class:T(["room-status",b.status])},d(b.status==="waiting"?"招募中":"进行中"),3)]),t("div",Ue,[t("div",Ee,[(a(!0),n(z,null,D(b.members,R=>(a(),n("div",{key:R.characterId,class:"member-slot filled",title:R.name+" - "+p(R.role)},[t("div",{class:"slot-role",style:V({background:l(R.role)})},d(p(R.role).charAt(0)),5)],8,Je))),128)),(a(!0),n(z,null,D(5-b.members.length,R=>(a(),n("div",{key:"empty-"+R,class:"member-slot empty"},[o(e(re),{size:14})]))),128))]),t("span",Ke,d(b.members.length)+"/5",1)])]),o(e(I),{type:"primary",size:"small",disabled:e(k).isInRoom||b.members.length>=5,loading:_.value===b.id,onClick:R=>H(b.id)},{default:g(()=>[...y[11]||(y[11]=[v(" 加入 ",-1)])]),_:1},8,["disabled","loading","onClick"])]))),128))]),_:1})])]))}}),Xe=E(We,[["__scopeId","data-v-136d097b"]]),Ze={class:"room-detail-panel"},Qe={key:0,class:"no-room"},Ye={class:"room-header-card"},es={class:"room-title"},ss={class:"room-meta"},ts={key:0},as={class:"team-section"},os={class:"team-grid"},ns={class:"member-info"},rs={class:"member-name"},ls={class:"member-realm"},is={class:"member-power"},us={key:1,class:"empty-slot"},cs={class:"role-legend"},ds={class:"role-name"},ms={key:0,class:"progress-section"},ps={class:"stage-progress"},ys={class:"stage-icon"},vs={key:2},gs={class:"stage-name"},_s={class:"progress-line"},fs={key:0,class:"stage-results"},hs={class:"result-header"},ks={class:"result-stage"},ws={class:"result-status"},Rs={class:"result-events"},bs={key:1,class:"path-selection"},zs={class:"path-buttons"},$s={key:2,class:"rewards-section"},Ss={class:"rewards-grid"},Cs={class:"reward-item"},xs={class:"reward-item"},Is={key:0,class:"reward-item legendary"},Ps={class:"action-buttons"},Ls=U({__name:"RoomDetailPanel",setup(F){const s=J(),u=ce(),k=ze(),f=x(()=>{switch(s.currentRoom?.status){case"waiting":return"等待中";case"in_progress":return"进行中";case"completed":return"已通关";case"failed":return"已失败";case"disbanded":return"已解散";default:return"未知"}}),_=x(()=>{const i=[...s.currentRoom?.members||[]];for(;i.length<5;)i.push(null);return i}),$=x(()=>{const c=s.currentRoom;return c?(c.stageResults?.filter(r=>r.success).length||0)/3*100:0}),p=x(()=>{const c=s.currentRoom;return!(!c||c.status!=="in_progress"||c.currentStage===2&&!c.selectedPath)}),l=c=>q[c]?.name||"未知",w=c=>q[c]?.color||"#888",H=c=>c>=1e4?(c/1e4).toFixed(1)+"万":c.toLocaleString(),C=c=>{switch(c){case 1:return"灵渊之地";case 2:return"冰火之路";case 3:return"决战蛮胡子";default:return`第${c}关`}},y=c=>(s.currentRoom?.stageResults||[]).some(r=>r.stage===c&&r.success),b=c=>(s.currentRoom?.stageResults||[]).some(r=>r.stage===c&&!r.success),R=async c=>{k.warning({title:"踢出成员",content:"确定要将该成员踢出房间吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await s.kickMember(c),u.success("已踢出成员")}catch(i){u.error(i.message||"操作失败")}}})},j=async()=>{try{await s.startDungeon(),u.success("副本开始！")}catch(c){u.error(c.message||"开始失败")}},L=async c=>{try{await s.selectPath(c),u.success(`已选择${c==="ice"?"冰":"火"}之道`)}catch(i){u.error(i.message||"选择失败")}},G=async()=>{try{(await s.nextStage())?.stageResult?.success?u.success("闯关成功！"):u.error("闯关失败...")}catch(c){u.error(c.message||"操作失败")}},K=async()=>{try{await s.leaveRoom(),u.success("已离开房间")}catch(c){u.error(c.message||"离开失败")}},te=async()=>{k.warning({title:"解散房间",content:"确定要解散房间吗？所有成员都会被移出。",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await s.disbandRoom(),u.success("房间已解散")}catch(c){u.error(c.message||"解散失败")}}})};return(c,i)=>(a(),n("div",Ze,[e(s).currentRoom?(a(),n(z,{key:1},[t("div",Ye,[t("div",es,[t("h2",null,d(e(s).currentRoom.dungeonName||"虚天殿·降魔"),1),t("span",{class:T(["room-status",e(s).currentRoom.status])},d(f.value),3)]),t("div",ss,[t("span",null,"队长: "+d(e(s).currentRoom.leaderName),1),e(s).isInProgress?(a(),n("span",ts,"当前第 "+d(e(s).currentRoom.currentStage)+" 关",1)):h("",!0)])]),t("div",as,[t("h3",null,[o(e(Q),{size:16}),v(" 队伍成员 ("+d(e(s).memberCount)+"/5) ",1)]),t("div",os,[(a(!0),n(z,null,D(_.value,(r,A)=>(a(),n("div",{key:r?.characterId||"empty-"+A,class:T(["member-card",{empty:!r,leader:r?.characterId===e(s).currentRoom.leaderId}])},[r?(a(),n(z,{key:0},[t("div",{class:"member-role",style:V({background:w(r.role)})},d(l(r.role)),5),t("div",ns,[t("span",rs,[v(d(r.name)+" ",1),r.characterId===e(s).currentRoom.leaderId?(a(),N(e(he),{key:0,size:12,class:"leader-icon"})):h("",!0)]),t("span",ls,d(r.realmName||"未知境界"),1),t("span",is,"战力 "+d(H(r.power)),1)]),e(s).isLeader&&r.characterId!==e(s).currentRoom.leaderId&&e(s).currentRoom.status==="waiting"?(a(),N(e(I),{key:0,quaternary:"",size:"tiny",type:"error",class:"kick-btn",onClick:W=>R(r.characterId)},{default:g(()=>[o(e(Z),{size:12})]),_:1},8,["onClick"])):h("",!0)],64)):(a(),n("div",us,[o(e(re),{size:24}),i[3]||(i[3]=t("span",null,"等待加入",-1))]))],2))),128))]),t("div",cs,[(a(!0),n(z,null,D(e(q),(r,A)=>(a(),n("div",{key:A,class:"role-item"},[t("span",{class:"role-badge",style:V({background:r.color})},d(r.name.charAt(0)),5),t("span",ds,d(r.name),1)]))),128))])]),e(s).isInProgress||e(s).isCompleted?(a(),n("div",ms,[t("h3",null,[o(e(se),{size:16}),i[4]||(i[4]=v(" 副本进度 ",-1))]),t("div",ps,[(a(),n(z,null,D(3,r=>t("div",{key:r,class:T(["stage-node",{completed:y(r),current:e(s).currentRoom.currentStage===r&&e(s).isInProgress,failed:b(r)}])},[t("div",ys,[y(r)?(a(),N(e(le),{key:0,size:16})):b(r)?(a(),N(e(Z),{key:1,size:16})):(a(),n("span",vs,d(r),1))]),t("span",gs,d(C(r)),1)],2)),64)),t("div",_s,[t("div",{class:"progress-fill",style:V({width:$.value+"%"})},null,4)])]),e(s).currentRoom.stageResults?.length?(a(),n("div",fs,[(a(!0),n(z,null,D(e(s).currentRoom.stageResults,r=>(a(),n("div",{key:r.stage,class:T(["result-card",{success:r.success,failed:!r.success}])},[t("div",hs,[t("span",ks,d(r.stageName),1),t("span",ws,d(r.success?"通过":"失败"),1)]),t("div",Rs,[(a(!0),n(z,null,D(r.events,(A,W)=>(a(),n("p",{key:W,class:"result-event"},d(A),1))),128))])],2))),128))])):h("",!0)])):h("",!0),e(s).isInProgress&&e(s).currentRoom.currentStage===2&&!e(s).currentRoom.selectedPath&&e(s).isLeader?(a(),n("div",bs,[t("h3",null,[o(e(xe),{size:16}),i[5]||(i[5]=v(" 选择道路 ",-1))]),i[8]||(i[8]=t("p",{class:"path-hint"},"第二关需要选择冰道或火道，选择与队员灵根匹配的道路可获得加成",-1)),t("div",zs,[o(e(I),{type:"info",size:"large",loading:e(s).actionLoading,onClick:i[0]||(i[0]=r=>L("ice"))},{icon:g(()=>[o(e(Ie),{size:18})]),default:g(()=>[i[6]||(i[6]=v(" 冰之道 ",-1))]),_:1},8,["loading"]),o(e(I),{type:"warning",size:"large",loading:e(s).actionLoading,onClick:i[1]||(i[1]=r=>L("fire"))},{icon:g(()=>[o(e(ke),{size:18})]),default:g(()=>[i[7]||(i[7]=v(" 火之道 ",-1))]),_:1},8,["loading"])])])):h("",!0),e(s).isCompleted&&e(s).currentRoom.rewards?(a(),n("div",$s,[t("h3",null,[o(e(we),{size:16}),i[9]||(i[9]=v(" 副本奖励 ",-1))]),t("div",Ss,[t("div",Cs,[o(e(ie),{size:20}),t("span",null,"修为 +"+d(H(e(s).currentRoom.rewards.exp)),1)]),t("div",xs,[o(e(ue),{size:20}),t("span",null,"宗门贡献 +"+d(e(s).currentRoom.rewards.sectContribution),1)]),e(s).currentRoom.rewards.xutianDingFragment?(a(),n("div",Is,[o(e(O),{size:20}),i[10]||(i[10]=t("span",null,"虚天鼎残片 x1",-1))])):h("",!0),(a(!0),n(z,null,D(e(s).currentRoom.rewards.items,r=>(a(),n("div",{key:r.itemId,class:"reward-item"},[o(e(Re),{size:20}),t("span",null,d(r.name)+" x"+d(r.quantity),1)]))),128))])])):h("",!0),t("div",Ps,[e(s).currentRoom.status==="waiting"?(a(),n(z,{key:0},[e(s).isLeader?(a(),N(e(I),{key:0,type:"primary",size:"large",disabled:!e(s).canStart,loading:e(s).actionLoading,onClick:j},{icon:g(()=>[o(e(Ce),{size:18})]),default:g(()=>[i[11]||(i[11]=v(" 开始副本 ",-1))]),_:1},8,["disabled","loading"])):h("",!0),e(s).isLeader?(a(),N(e(I),{key:1,type:"error",size:"large",loading:e(s).actionLoading,onClick:te},{default:g(()=>[...i[12]||(i[12]=[v(" 解散房间 ",-1)])]),_:1},8,["loading"])):(a(),N(e(I),{key:2,type:"default",size:"large",loading:e(s).actionLoading,onClick:K},{default:g(()=>[...i[13]||(i[13]=[v("离开房间",-1)])]),_:1},8,["loading"]))],64)):e(s).isInProgress?(a(),n(z,{key:1},[e(s).isLeader&&p.value?(a(),N(e(I),{key:0,type:"primary",size:"large",loading:e(s).actionLoading,onClick:G},{icon:g(()=>[o(e(be),{size:18})]),default:g(()=>[v(" "+d(e(s).currentRoom.currentStage<3?"进入下一关":"挑战Boss"),1)]),_:1},8,["loading"])):h("",!0)],64)):e(s).isCompleted?(a(),N(e(I),{key:2,type:"primary",size:"large",onClick:K},{default:g(()=>[...i[14]||(i[14]=[v("离开副本",-1)])]),_:1})):h("",!0)])],64)):(a(),n("div",Qe,[o(e(ee),{size:48}),i[2]||(i[2]=t("p",null,"未加入任何房间",-1))]))]))}}),Ms=E(Ls,[["__scopeId","data-v-749639e2"]]),Ds={class:"history-panel"},Ns={class:"panel-header"},js={class:"stats-row"},Ts={class:"stat-item"},Fs={class:"stat-item"},Hs={key:0,class:"loading-state"},As={key:1,class:"empty-state"},qs={key:2,class:"history-list"},Vs={class:"card-header"},Bs={class:"card-title"},Gs={class:"card-details"},Os={key:0,class:"failed-stage"},Us={class:"card-time"},Es={key:0,class:"card-rewards"},Js={key:0},Ks={key:1},Ws={key:2,class:"legendary"},Xs=U({__name:"HistoryPanel",setup(F){const s=J(),u=M(!1),k=$=>$>=1e4?($/1e4).toFixed(1)+"万":$.toLocaleString(),f=$=>{const p=new Date($),w=new Date().getTime()-p.getTime();return w<6e4?"刚刚":w<36e5?Math.floor(w/6e4)+"分钟前":w<864e5?Math.floor(w/36e5)+"小时前":w<6048e5?Math.floor(w/864e5)+"天前":p.toLocaleDateString()},_=async()=>{u.value=!0;try{await s.fetchHistory(20)}finally{u.value=!1}};return ae(async()=>{u.value=!0;try{await s.fetchHistory(20)}finally{u.value=!1}}),($,p)=>(a(),n("div",Ds,[t("div",Ns,[t("h3",null,[o(e(oe),{size:16}),p[0]||(p[0]=v(" 副本记录 ",-1))]),o(e(I),{quaternary:"",size:"small",loading:u.value,onClick:_},{icon:g(()=>[o(e(ne),{size:14,class:T({spinning:u.value})},null,8,["class"])]),default:g(()=>[p[1]||(p[1]=v(" 刷新 ",-1))]),_:1},8,["loading"])]),t("div",js,[t("div",Ts,[o(e(O),{size:16}),t("span",null,"虚天鼎残片: "+d(e(s).status?.xutianDingFragments||0)+"/100",1)]),t("div",Fs,[o(e(Y),{size:16}),t("span",null,"虚天残图: "+d(e(s).status?.xutianMapCount||0),1)])]),u.value&&e(s).history.length===0?(a(),n("div",Hs,[o(e(de),{size:24,class:"spinning"}),p[2]||(p[2]=t("span",null,"加载中...",-1))])):e(s).history.length===0?(a(),n("div",As,[o(e(ee),{size:48}),p[3]||(p[3]=t("p",null,"暂无副本记录",-1)),p[4]||(p[4]=t("span",null,"完成副本挑战后记录将显示在这里",-1))])):(a(),n("div",qs,[(a(!0),n(z,null,D(e(s).history,l=>(a(),n("div",{key:l.id,class:T(["history-card",l.result])},[t("div",Vs,[t("div",Bs,[o(e(se),{size:14}),t("span",null,d(l.dungeonName||"虚天殿·降魔"),1)]),t("span",{class:T(["card-result",l.result])},d(l.result==="success"?"通关":"失败"),3)]),t("div",Gs,[l.result==="failed"?(a(),n("span",Os,[o(e(Z),{size:12}),v(" 止步第"+d(l.failedAtStage)+"关 ",1)])):h("",!0),t("span",Us,[o(e($e),{size:12}),v(" "+d(f(l.clearedAt)),1)])]),l.rewards?(a(),n("div",Es,[l.rewards.exp?(a(),n("span",Js,[o(e(ie),{size:12}),v(" +"+d(k(l.rewards.exp))+" 修为 ",1)])):h("",!0),l.rewards.sectContribution?(a(),n("span",Ks,[o(e(ue),{size:12}),v(" +"+d(l.rewards.sectContribution)+" 贡献 ",1)])):h("",!0),l.rewards.xutianDingFragment?(a(),n("span",Ws,[o(e(O),{size:12}),p[5]||(p[5]=v(" 虚天鼎残片 ",-1))])):h("",!0)])):h("",!0)],2))),128))]))]))}}),Zs=E(Xs,[["__scopeId","data-v-e64aefb1"]]),Qs={class:"dungeon-page"},Ys={key:0,class:"loading-state"},et={class:"dungeon-particles"},st={class:"dungeon-header"},tt={class:"header-left"},at={class:"dungeon-icon-wrapper"},ot={class:"header-info"},nt={class:"header-meta"},rt={class:"meta-item"},lt={class:"meta-item"},it={class:"header-actions"},ut={class:"tab-label"},ct={key:0,class:"tab-badge"},dt={class:"tab-content"},mt={class:"tab-label"},pt={key:0,class:"tab-badge active"},yt={class:"tab-content"},vt={class:"tab-label"},gt={class:"tab-content"},_t=U({__name:"DungeonHub",setup(F){const s=J(),u=ce(),k=M(!0),f=M("lobby"),_=async p=>{try{await s.joinRoom(p),u.success("加入房间成功"),f.value="room"}catch(l){u.error(l.message||"加入失败")}},$=async()=>{try{await s.createRoom(),u.success("房间创建成功"),f.value="room"}catch(p){u.error(p.message||"创建失败")}};return ve(()=>s.isInRoom,p=>{p&&f.value==="lobby"?f.value="room":!p&&f.value==="room"&&(f.value="lobby")}),ae(async()=>{try{await s.initialize(),s.isInRoom&&(f.value="room")}finally{k.value=!1}}),(p,l)=>(a(),n("div",Qs,[k.value?(a(),n("div",Ys,[o(e(de),{size:32,class:"spinning"}),l[1]||(l[1]=t("span",null,"正在加载副本信息...",-1))])):(a(),n(z,{key:1},[t("div",et,[(a(),n(z,null,D(8,w=>t("div",{key:w,class:"particle",style:V({"--delay":w*.8+"s","--x":Math.random()*100+"%"})},null,4)),64))]),t("div",st,[l[5]||(l[5]=t("div",{class:"header-glow"},null,-1)),t("div",tt,[t("div",at,[l[2]||(l[2]=t("div",{class:"icon-glow"},null,-1)),o(e(se),{size:24,class:"dungeon-icon"})]),t("div",ot,[l[3]||(l[3]=t("h1",null,"虚天殿",-1)),t("div",nt,[t("span",rt,[o(e(Y),{size:12}),v(" 虚天残图 x"+d(e(s).status?.xutianMapCount||0),1)]),t("span",lt,[o(e(O),{size:12}),v(" 虚天鼎残片 x"+d(e(s).status?.xutianDingFragments||0),1)])])])]),t("div",it,[e(s).status?.hasFirstClearThisWeek?(a(),N(e(I),{key:0,type:"success",size:"small",disabled:""},{icon:g(()=>[o(e(le),{size:14})]),default:g(()=>[l[4]||(l[4]=v(" 本周已首通 ",-1))]),_:1})):h("",!0)])]),o(e(Se),{value:f.value,"onUpdate:value":l[0]||(l[0]=w=>f.value=w),type:"segment",animated:"",class:"dungeon-tabs"},{default:g(()=>[o(e(X),{name:"lobby"},{tab:g(()=>[t("div",ut,[o(e(Q),{size:14}),l[6]||(l[6]=t("span",null,"大厅",-1)),e(s).rooms.length>0?(a(),n("span",ct,d(e(s).rooms.length),1)):h("",!0)])]),default:g(()=>[t("div",dt,[o(Xe,{onJoin:_,onCreate:$})])]),_:1}),o(e(X),{name:"room",disabled:!e(s).isInRoom},{tab:g(()=>[t("div",mt,[o(e(me),{size:14}),l[7]||(l[7]=t("span",null,"房间",-1)),e(s).isInRoom?(a(),n("span",pt,"!")):h("",!0)])]),default:g(()=>[t("div",yt,[o(Ms)])]),_:1},8,["disabled"]),o(e(X),{name:"history"},{tab:g(()=>[t("div",vt,[o(e(oe),{size:14}),l[8]||(l[8]=t("span",null,"记录",-1))])]),default:g(()=>[t("div",gt,[o(Zs)])]),_:1})]),_:1},8,["value"])],64))]))}}),Qt=E(_t,[["__scopeId","data-v-b0d800ee"]]);export{Qt as default};
