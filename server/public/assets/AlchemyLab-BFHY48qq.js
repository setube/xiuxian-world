import{u as U}from"./inventory-C7YLZSJU.js";import{F as b}from"./flame-DuW_991e.js";import{B as A}from"./book-open-B-z3oi1Q.js";import{S as D}from"./scroll-CZOg3h_v.js";import{P as T}from"./package-CRVIogFf.js";import{C as P}from"./check-Dvn_Mgz0.js";import{L as j}from"./lock-CWZIQcVF.js";import{C as E}from"./coins-Ks2rpWqM.js";import{L as O}from"./loader-Bk8qWIrR.js";import{S as Z}from"./sword-BlVHvUf1.js";import{e as G,f as y,N as H,x as J,S as K,c as l,a as e,d as r,g as u,w as h,r as W,n as p,p as _,Z as i,F as S,q as L,l as w,a4 as $,a1 as X,s as x,j as Q,o as a}from"./index-DA11XDlS.js";import{_ as Y}from"./InputNumber-tuzvZVlG.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createLucideIcon-DiiZaxVK.js";import"./Input-DOOhwlQ-.js";import"./use-locale-EBm6emhn.js";import"./use-merged-state-DvdMjKiF.js";import"./Add-C6IKdIGC.js";const se={class:"alchemy-page"},te={class:"page-header"},ae={class:"header-info"},le={class:"recipe-tabs"},ne={key:0,class:"tab-badge"},oe={key:0,class:"recipe-list"},ie=["onClick"],ue={class:"recipe-info"},re={class:"recipe-type"},ce={class:"recipe-status"},de={key:0,class:"status-learned"},ve={key:1,class:"status-locked"},me={key:1,class:"empty-state"},pe={key:0},fe={key:1},ye={key:0,class:"craft-content"},_e={class:"craft-info-grid"},he={class:"info-item"},ke={class:"info-value"},Ce={class:"info-item"},ge={class:"info-item"},be={class:"info-value"},we={class:"info-item"},xe={class:"info-value"},Re={key:0},ze={class:"craft-desc"},Se={class:"materials-section"},Le={class:"materials-list"},qe={class:"material-name"},Be={key:0,class:"spirit-stone-cost"},Ne={class:"craft-times"},Te={class:"times-control"},$e=["disabled"],Qe={key:0,class:"result-content"},Ie={class:"result-message"},Me={key:0,class:"result-details"},Fe={key:0,class:"success-text"},Ve={key:1,class:"fail-text"},Ue=G({__name:"AlchemyLab",setup(Ae){const v=U(),f=y("learned"),n=y(null),C=y(!1),c=y(1),d=y(null),k=y(!1),m=y(null),q=H(()=>f.value==="learned"?v.learnedRecipes.map(o=>({...o,learned:!0})):v.allRecipes),g=o=>({common:"#9d9d9d",uncommon:"#1eff00",rare:"#0070dd",epic:"#a335ee",legendary:"#ff8000"})[o||"common"],I=o=>({common:"普通",uncommon:"优秀",rare:"稀有",epic:"史诗",legendary:"传说"})[o||"common"],B=o=>({alchemy:"炼丹",crafting:"炼器"})[o||"alchemy"],M=o=>({alchemy:b,crafting:Z})[o||"alchemy"],F=async o=>{o.learned&&(n.value=o,c.value=1,C.value=!0,await R())},R=async()=>{if(n.value)try{const o=await v.checkCanCraft(n.value.id,c.value);d.value=o}catch{d.value={canCraft:!1,reason:"检查失败",maxTimes:0,materials:[]}}};J(c,()=>{R()});const V=async()=>{if(!(!n.value||!d.value?.canCraft))try{const o=await v.craft(n.value.id,c.value);m.value=o,C.value=!1,k.value=!0,await R()}catch(o){m.value={success:!1,message:o.message||"炼制失败",outputQuantity:0,craftResults:[]},k.value=!0}};return K(()=>{v.fetchRecipes(),v.fetchInventory()}),(o,s)=>{const N=W("router-link");return a(),l("div",se,[e("div",te,[e("div",ae,[r(u(b),{size:24}),s[9]||(s[9]=e("div",null,[e("h1",null,"炼丹炉"),e("p",null,"炼制丹药法宝，需先学习配方")],-1))]),r(N,{to:"/inventory",class:"inventory-link"},{default:h(()=>[r(u(T),{size:16}),s[10]||(s[10]=e("span",null,"储物袋",-1))]),_:1})]),e("div",le,[e("button",{class:p(["recipe-tab",{active:f.value==="learned"}]),onClick:s[0]||(s[0]=t=>f.value="learned")},[r(u(A),{size:14}),s[11]||(s[11]=e("span",null,"已学配方",-1)),u(v).learnedRecipes.length?(a(),l("span",ne,i(u(v).learnedRecipes.length),1)):_("",!0)],2),e("button",{class:p(["recipe-tab",{active:f.value==="all"}]),onClick:s[1]||(s[1]=t=>f.value="all")},[r(u(D),{size:14}),s[12]||(s[12]=e("span",null,"全部配方",-1))],2)]),q.value.length>0?(a(),l("div",oe,[(a(!0),l(S,null,L(q.value,t=>(a(),l("div",{key:t.id,class:p(["recipe-card",{disabled:!t.learned,selected:n.value?.id===t.id}]),onClick:z=>F(t)},[e("div",{class:"recipe-icon",style:x({borderColor:g(t.quality)})},[(a(),w(X(M(t.type)),{size:22}))],4),e("div",ue,[e("div",{class:"recipe-name",style:x({color:g(t.quality)})},i(t.name),5),e("div",re,i(B(t.type)),1)]),e("div",ce,[t.learned?(a(),l("span",de,[r(u(P),{size:14})])):(a(),l("span",ve,[r(u(j),{size:14})]))])],10,ie))),128))])):(a(),l("div",me,[r(u(b),{size:48}),f.value==="learned"?(a(),l("span",pe,"尚未学习任何配方")):(a(),l("span",fe,"暂无可用配方")),f.value==="learned"?(a(),w(N,{key:2,to:"/inventory",class:"go-inventory"},{default:h(()=>[...s[13]||(s[13]=[Q("前往储物袋学习配方",-1)])]),_:1})):_("",!0)])),r(u($),{show:C.value,"onUpdate:show":s[6]||(s[6]=t=>C.value=t),preset:"card",style:{width:"90%","max-width":"420px"}},{header:h(()=>[e("div",{class:"craft-header",style:x({color:g(n.value?.quality)})},i(n.value?.name),5)]),default:h(()=>[n.value?(a(),l("div",ye,[e("div",_e,[e("div",he,[s[14]||(s[14]=e("span",{class:"info-label"},"类型",-1)),e("span",ke,i(B(n.value.type)),1)]),e("div",Ce,[s[15]||(s[15]=e("span",{class:"info-label"},"品质",-1)),e("span",{class:"info-value",style:x({color:g(n.value.quality)})},i(I(n.value.quality)),5)]),e("div",ge,[s[16]||(s[16]=e("span",{class:"info-label"},"成功率",-1)),e("span",be,i(n.value.successRate)+"%",1)]),e("div",we,[s[17]||(s[17]=e("span",{class:"info-label"},"产出",-1)),e("span",xe,[Q(i(n.value.outputQuantity)+" ",1),n.value.outputQuantityBonus?(a(),l("span",Re," ~"+i(n.value.outputQuantity+n.value.outputQuantityBonus),1)):_("",!0)])])]),e("div",ze,i(n.value.description),1),e("div",Se,[e("h3",null,[r(u(T),{size:16}),s[18]||(s[18]=e("span",null,"所需材料",-1))]),e("div",Le,[(a(!0),l(S,null,L(d.value?.materials||[],t=>(a(),l("div",{key:t.itemId,class:p(["material-item",{lacking:!t.enough}])},[e("span",qe,i(t.itemName),1),e("span",{class:p(["material-count",{enough:t.enough}])},i(t.owned)+" / "+i(t.required),3)],2))),128))]),n.value.spiritStoneCost?(a(),l("div",Be,[r(u(E),{size:14}),e("span",null,"消耗灵石: "+i(n.value.spiritStoneCost*c.value),1)])):_("",!0)]),e("div",Ne,[s[19]||(s[19]=e("span",null,"炼制次数",-1)),e("div",Te,[e("button",{onClick:s[2]||(s[2]=t=>c.value=Math.max(1,c.value-1))},"-"),r(u(Y),{value:c.value,"onUpdate:value":s[3]||(s[3]=t=>c.value=t),min:1,max:d.value?.maxTimes||1,size:"small"},null,8,["value","max"]),e("button",{onClick:s[4]||(s[4]=t=>c.value=Math.min(d.value?.maxTimes||1,c.value+1))},"+"),e("button",{class:"max-btn",onClick:s[5]||(s[5]=t=>c.value=d.value?.maxTimes||1)},"最大")])]),e("button",{class:p(["craft-btn",{disabled:!d.value?.canCraft}]),disabled:!d.value?.canCraft||u(v).craftLoading,onClick:V},[u(v).craftLoading?(a(),w(u(O),{key:1,size:16,class:"spinning"})):(a(),w(u(b),{key:0,size:16})),e("span",null,i(d.value?.canCraft?"开始炼制":d.value?.reason||"无法炼制"),1)],10,$e)])):_("",!0)]),_:1},8,["show"]),r(u($),{show:k.value,"onUpdate:show":s[8]||(s[8]=t=>k.value=t),preset:"card",style:{width:"90%","max-width":"360px"}},{header:h(()=>[e("div",{class:p(["result-header",{success:m.value?.success,failed:!m.value?.success}])},i(m.value?.success?"炼制完成":"炼制失败"),3)]),default:h(()=>[m.value?(a(),l("div",Qe,[e("div",Ie,i(m.value.message),1),m.value.craftResults?.length>1?(a(),l("div",Me,[(a(!0),l(S,null,L(m.value.craftResults,(t,z)=>(a(),l("div",{key:z,class:p(["result-item",{success:t.success}])},[e("span",null,"第 "+i(z+1)+" 次",1),t.success?(a(),l("span",Fe,"成功 +"+i(t.quantity),1)):(a(),l("span",Ve,"失败"))],2))),128))])):_("",!0),e("button",{class:"close-result-btn",onClick:s[7]||(s[7]=t=>k.value=!1)},"确定")])):_("",!0)]),_:1},8,["show"])])}}}),ns=ee(Ue,[["__scopeId","data-v-2d96a82c"]]);export{ns as default};
