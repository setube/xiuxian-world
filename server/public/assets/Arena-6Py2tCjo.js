import{e as R,X as U,f as y,S as V,a0 as ss,N as w,c as n,p as g,n as S,a as s,l as B,a1 as F,Z as a,d as i,g as o,o as e,j as k,F as H,q as L,w as ts,a4 as es,aa as E,k as A}from"./index-DA11XDlS.js";import{T as as}from"./triangle-alert-vQJa5xBQ.js";import{H as ns}from"./heart-crack-rbfRmzuO.js";import{C as os}from"./clock-Bnzg_83l.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as M}from"./skull-BAbr3491.js";import{F as P}from"./flame-DuW_991e.js";import{_ as q}from"./Spin-C-vu5Ffa.js";import{F as ls}from"./feather-CS67xDvV.js";import{Z as is}from"./zap-vMqaBpWc.js";import{S as I}from"./swords-bfqjVPqN.js";import{C as rs}from"./circle-check-big-B5OYv702.js";import{C as us}from"./circle-x-B-Ydbwdk.js";import{T as cs}from"./target-CxCFSND-.js";import{H as X}from"./history-F1M976CY.js";import{U as ds}from"./users-DzD0wEV-.js";import{R as j}from"./refresh-cw-5h0-qbhL.js";import{S as vs}from"./sword-BlVHvUf1.js";import{T as ms}from"./trophy-B8Qqs7MA.js";import{F as ps}from"./frown-DdlGX0TI.js";import{T as _s}from"./trending-up-BXfb3B-f.js";import{u as hs}from"./use-message--i6DiThE.js";import"./createLucideIcon-DiiZaxVK.js";import"./use-compitable-BnEdbODL.js";const fs={class:"status-icon"},ys={class:"status-info"},gs={class:"status-title"},ws={class:"status-countdown"},Ss={key:0,class:"status-effect"},ks=R({__name:"SoulStatusBadge",props:{showEffect:{type:Boolean,default:!0}},setup(D){const c=U(),_=y(Date.now());let h=null;V(()=>{h=window.setInterval(()=>{_.value=Date.now()},1e3)}),ss(()=>{h&&clearInterval(h)});const $=w(()=>c.isSoulTurbulent||c.isSoulShattered),m=w(()=>c.isSoulTurbulent?"turbulent":c.isSoulShattered?"shattered":null),p=w(()=>m.value?`status-${m.value}`:""),d=w(()=>m.value==="turbulent"?as:ns),b=w(()=>m.value==="turbulent"?"神魂动荡":"道心破碎"),v=w(()=>c.soulStatus?m.value==="turbulent"?`战力-${c.soulStatus.turbulent.powerReduction*100}%`:m.value==="shattered"?`闭关-${c.soulStatus.shattered.cultivationPenalty*100}%`:"":""),C=w(()=>{if(!c.soulStatus)return"";let r=null;if(m.value==="turbulent"?r=c.soulStatus.turbulent.expiresAt:m.value==="shattered"&&(r=c.soulStatus.shattered.expiresAt),!r)return"";const f=r-_.value;if(f<=0)return"已结束";const T=Math.floor(f/(1e3*60*60)),z=Math.floor(f%(1e3*60*60)/(1e3*60)),x=Math.floor(f%(1e3*60)/1e3);return T>0?`${T}时${z}分`:`${z}分${x}秒`});return(r,f)=>$.value?(e(),n("div",{key:0,class:S(["soul-status-badge",p.value])},[s("div",fs,[(e(),B(F(d.value),{size:16}))]),s("div",ys,[s("div",gs,a(b.value),1),s("div",ws,[i(o(os),{size:12}),s("span",null,a(C.value),1)])]),D.showEffect?(e(),n("div",Ss,a(v.value),1)):g("",!0)],2)):g("",!0)}}),Cs=Z(ks,[["__scopeId","data-v-97c722d3"]]),bs={class:"enemy-list-panel"},$s={class:"panel-header"},zs={class:"header-left"},Ts={class:"header-right"},xs={class:"kill-count"},Ns={key:0,class:"loading-state"},Es={key:1,class:"empty-state"},As={key:2,class:"enemy-list"},Bs={class:"enemy-info"},Ds={class:"enemy-name"},Fs={class:"enemy-meta"},Hs={class:"kill-time"},Ls={class:"kill-times"},Ms={class:"enemy-bonus"},Ps={class:"panel-footer"},Is={class:"bonus-tip"},Rs=R({__name:"EnemyListPanel",setup(D){const c=U(),_=y(!1),h=w(()=>c.soulStatus?.enemies||[]),$=w(()=>c.soulStatus?.killCount||0),m=p=>{const d=new Date(p),v=Date.now()-p;if(v<3600*1e3){const C=Math.floor(v/6e4);return C<=0?"刚刚":`${C}分钟前`}return v<1440*60*1e3?`${Math.floor(v/36e5)}小时前`:d.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})};return V(async()=>{c.soulStatus||(_.value=!0,await c.fetchSoulStatus(),_.value=!1)}),(p,d)=>{const b=q;return e(),n("div",bs,[s("div",$s,[s("div",zs,[i(o(M),{size:18}),d[0]||(d[0]=s("span",null,"仇敌名录",-1))]),s("div",Ts,[s("span",xs,[i(o(P),{size:14}),k(" 杀戮值: "+a($.value),1)])])]),_.value?(e(),n("div",Ns,[i(b,{size:"small"}),d[1]||(d[1]=s("span",null,"加载中...",-1))])):h.value.length===0?(e(),n("div",Es,[i(o(ls),{size:32,class:"empty-icon"}),d[2]||(d[2]=s("span",null,"暂无仇敌",-1)),d[3]||(d[3]=s("p",{class:"empty-tip"},"被击杀时，对方将被记入仇敌名录",-1))])):(e(),n("div",As,[(e(!0),n(H,null,L(h.value,v=>(e(),n("div",{key:v.oderId,class:"enemy-item"},[s("div",Bs,[s("div",Ds,a(v.killerName),1),s("div",Fs,[s("span",Hs,a(m(v.killedAt)),1),s("span",Ls,"击杀 "+a(v.killCount)+" 次",1)])]),s("div",Ms,[i(o(I),{size:14}),d[4]||(d[4]=s("span",null,"+5%",-1))])]))),128))])),s("div",Ps,[s("p",Is,[i(o(is),{size:14}),d[5]||(d[5]=k(" 对仇敌斗法时，战力+5% ",-1))])])])}}}),Us=Z(Rs,[["__scopeId","data-v-2daf53c4"]]),Vs={class:"arena-page"},Zs={class:"page-header"},Gs={class:"header-icon"},Xs={class:"status-bar"},js={class:"status-item"},qs={class:"tabs"},Js={key:1,class:"targets-section"},Ks={key:0,class:"loading-state"},Os={key:1,class:"empty-state"},Qs={key:2,class:"target-list"},Ws={class:"target-info"},Ys={class:"target-name"},st={key:0,class:"enemy-tag"},tt={class:"target-realm"},et={key:0,class:"target-sect"},at={class:"target-power"},nt={key:0,class:"enemy-bonus"},ot=["disabled","onClick"],lt={key:2,class:"history-section"},it={key:0,class:"loading-state"},rt={key:1,class:"empty-state"},ut={key:2,class:"history-list"},ct={class:"history-info"},dt={class:"opponent-name"},vt={class:"battle-time"},mt={class:"history-result"},pt={class:"result-badge"},_t={key:3,class:"enemies-section"},ht={class:"battle-result"},ft={class:"result-text"},yt={class:"result-message"},gt={class:"power-compare"},wt={class:"power-item"},St={class:"power-value"},kt={class:"power-item"},Ct={class:"power-value"},bt={key:0,class:"rewards-info"},$t={key:0,class:"reward-item positive"},zt=R({__name:"Arena",setup(D){const c=hs(),_=U(),h=y(null),$=y([]),m=y([]),p=y("targets"),d=y(!1),b=y(!1),v=y(!1),C=y(!1),r=y(null),f=w(()=>h.value?.canChallenge&&!_.isSoulShattered),T=w(()=>_.isSoulShattered?"道心破碎，无法斗法":h.value?.canChallenge?"":"挑战次数已用尽"),z=u=>_.isEnemy(u),x=async()=>{try{const u=await E.getStatus();h.value=u.data}catch(u){c.error(A(u,"获取状态失败"))}},N=async()=>{d.value=!0;try{const u=await E.getTargets(20);$.value=u.data}catch(u){c.error(A(u,"获取目标失败"))}finally{d.value=!1}},J=async()=>{b.value=!0;try{const u=await E.getHistory(20);m.value=u.data}catch(u){c.error(A(u,"获取记录失败"))}finally{b.value=!1}},K=async()=>{p.value="history",m.value.length===0&&await J()},O=async u=>{if(!(!f.value||v.value)){v.value=!0;try{const t=await E.challenge(u);r.value=t.data,C.value=!0,await Promise.all([x(),N(),_.fetchSoulStatus()])}catch(t){c.error(A(t,"挑战失败"))}finally{v.value=!1}}},Q=u=>new Date(u).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),W=u=>u==="win"?"胜":u==="lose"?"败":"平";return V(async()=>{await Promise.all([x(),N(),_.fetchSoulStatus()])}),(u,t)=>{const G=q,Y=es;return e(),n("div",Vs,[s("div",Zs,[s("div",Gs,[i(o(I),{size:24})]),t[3]||(t[3]=s("div",{class:"header-info"},[s("h2",null,"斗法场"),s("p",null,"与其他修士一决高下")],-1))]),o(_).isSoulTurbulent||o(_).isSoulShattered?(e(),B(Cs,{key:0,class:"soul-status-section"})):g("",!0),s("div",Xs,[s("div",js,[i(o(P),{size:16}),s("span",null,"今日挑战："+a(h.value?.dailyChallenges||0)+" / "+a(h.value?.maxChallenges||10),1)]),s("div",{class:S(["status-item",{ready:f.value,disabled:!f.value}])},[(e(),B(F(f.value?o(rs):o(us)),{size:16})),s("span",null,a(f.value?"可挑战":T.value),1)],2)]),s("div",qs,[s("div",{class:S(["tab-item",{active:p.value==="targets"}]),onClick:t[0]||(t[0]=l=>p.value="targets")},[i(o(cs),{size:16}),t[4]||(t[4]=k(" 挑战目标 ",-1))],2),s("div",{class:S(["tab-item",{active:p.value==="history"}]),onClick:K},[i(o(X),{size:16}),t[5]||(t[5]=k(" 战斗记录 ",-1))],2),s("div",{class:S(["tab-item",{active:p.value==="enemies"}]),onClick:t[1]||(t[1]=l=>p.value="enemies")},[i(o(M),{size:16}),t[6]||(t[6]=k(" 仇敌名录 ",-1))],2)]),p.value==="targets"?(e(),n("div",Js,[d.value?(e(),n("div",Ks,[i(G,{size:"medium"}),t[7]||(t[7]=s("span",null,"搜寻对手中...",-1))])):$.value.length===0?(e(),n("div",Os,[i(o(ds),{size:48,class:"empty-icon"}),t[9]||(t[9]=s("span",null,"暂无可挑战的目标",-1)),s("button",{class:"refresh-btn",onClick:N},[i(o(j),{size:14}),t[8]||(t[8]=k(" 刷新列表 ",-1))])])):(e(),n("div",Qs,[(e(!0),n(H,null,L($.value,l=>(e(),n("div",{key:l.id,class:S(["target-card",{"is-enemy":z(l.id)}])},[s("div",Ws,[s("div",Ys,[k(a(l.name)+" ",1),z(l.id)?(e(),n("span",st,[i(o(M),{size:12}),t[10]||(t[10]=k(" 仇敌 ",-1))])):g("",!0)]),s("div",tt,a(l.realmName),1),l.sectName?(e(),n("div",et,a(l.sectName),1)):g("",!0)]),s("div",at,[i(o(vs),{size:14}),s("span",null,a(l.power.toLocaleString()),1),z(l.id)?(e(),n("span",nt,"+5%")):g("",!0)]),s("button",{class:"challenge-btn",disabled:!f.value||v.value,onClick:Tt=>O(l.id)},[i(o(I),{size:14}),t[11]||(t[11]=k(" 挑战 ",-1))],8,ot)],2))),128)),s("button",{class:"refresh-btn",onClick:N},[i(o(j),{size:14}),t[12]||(t[12]=k(" 刷新列表 ",-1))])]))])):g("",!0),p.value==="history"?(e(),n("div",lt,[b.value?(e(),n("div",it,[i(G,{size:"medium"}),t[13]||(t[13]=s("span",null,"加载中...",-1))])):m.value.length===0?(e(),n("div",rt,[i(o(X),{size:48,class:"empty-icon"}),t[14]||(t[14]=s("span",null,"暂无战斗记录",-1))])):(e(),n("div",ut,[(e(!0),n(H,null,L(m.value,l=>(e(),n("div",{key:l.id,class:S(["history-item",l.result])},[s("div",ct,[s("span",dt,a(l.isChallenger?"挑战":"被")+" "+a(l.opponentName),1),s("span",vt,a(Q(l.createdAt)),1)]),s("div",mt,[s("span",pt,a(W(l.result)),1),s("span",{class:S(["cultivation-change",{positive:l.cultivationChange>0,negative:l.cultivationChange<0}])},a(l.cultivationChange>0?"+":"")+a(l.cultivationChange),3)])],2))),128))]))])):g("",!0),p.value==="enemies"?(e(),n("div",_t,[i(Us)])):g("",!0),i(Y,{show:C.value,"onUpdate:show":t[2]||(t[2]=l=>C.value=l),preset:"card",title:"战斗结果",style:{"max-width":"400px"}},{default:ts(()=>[s("div",ht,[s("div",{class:S(["result-header",r.value?.success?"win":"lose"])},[(e(),B(F(r.value?.success?o(ms):o(ps)),{size:48})),s("span",ft,a(r.value?.success?"胜利":"失败"),1)],2),s("p",yt,a(r.value?.message),1),s("div",gt,[s("div",wt,[t[15]||(t[15]=s("span",{class:"power-label"},"我方战力",-1)),s("span",St,a(r.value?.challengerPower?.toLocaleString()),1)]),t[17]||(t[17]=s("span",{class:"vs"},"VS",-1)),s("div",kt,[t[16]||(t[16]=s("span",{class:"power-label"},"敌方战力",-1)),s("span",Ct,a(r.value?.defenderPower?.toLocaleString()),1)])]),r.value?.rewards?(e(),n("div",bt,[s("div",{class:S(["reward-item",{positive:r.value.rewards.cultivationChange>0,negative:r.value.rewards.cultivationChange<0}])},[i(o(_s),{size:14}),s("span",null,"修为 "+a(r.value.rewards.cultivationChange>0?"+":"")+a(r.value.rewards.cultivationChange),1)],2),r.value.rewards.shaEnergyGain>0?(e(),n("div",$t,[i(o(P),{size:14}),s("span",null,"煞气 +"+a(r.value.rewards.shaEnergyGain),1)])):g("",!0)])):g("",!0)])]),_:1},8,["show"])])}}}),Wt=Z(zt,[["__scopeId","data-v-cfb001a3"]]);export{Wt as default};
