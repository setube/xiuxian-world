import{e as B,f as u,S as I,a0 as U,c,a as s,d as n,g as l,Z as o,n as b,j as C,F as $,q as D,w as q,a4 as A,ca as f,k as x,p,l as N,a1 as E,o as i}from"./index-DA11XDlS.js";import{C as h}from"./coins-Ks2rpWqM.js";import{F as G}from"./flame-DuW_991e.js";import{T as j}from"./timer-C2OaA_iH.js";import{T as X}from"./target-CxCFSND-.js";import{R as Z}from"./refresh-cw-5h0-qbhL.js";import{U as H}from"./users-DzD0wEV-.js";import{S as F}from"./shield-BMlq6Nq0.js";import{S as J}from"./sword-BlVHvUf1.js";import{S as K}from"./swords-bfqjVPqN.js";import{c as O}from"./createLucideIcon-DiiZaxVK.js";import{S as Q}from"./skull-BAbr3491.js";import{u as W}from"./use-message--i6DiThE.js";import{_ as Y}from"./Spin-C-vu5Ffa.js";import{_ as ss}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-compitable-BnEdbODL.js";const ts=O("shield-x",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]),es={class:"loot-page"},as={class:"page-header"},os={class:"header-icon"},ls={class:"status-bar"},ns={class:"status-item"},is={key:0},rs={key:1},cs={class:"my-stats"},ds={class:"stat-item"},us={class:"stat-value"},vs={class:"stat-item"},ms={class:"stat-value"},ps={class:"targets-section"},_s={class:"section-header"},fs=["disabled"],hs={key:0,class:"loading-state"},gs={key:1,class:"empty-state"},ys={key:2,class:"target-list"},ws={class:"target-info"},ks={class:"target-name"},Ss={class:"target-realm"},Ls={key:0,class:"target-sect"},zs={class:"target-stats"},bs={class:"stat"},Cs={class:"stat treasure"},xs=["disabled","onClick"],Rs={class:"loot-result"},Ts={class:"result-text"},Ns={class:"result-message"},Fs={key:0,class:"loot-amount"},Ms={class:"power-compare"},Ps={class:"power-item"},Vs={class:"power-value"},Bs={class:"power-item"},Is={class:"power-value"},Us={key:1,class:"formation-blocked"},$s={key:2,class:"evil-gain"},Ds=B({__name:"Loot",setup(qs){const g=W(),a=u(null),y=u([]),v=u(null),m=u(!1),_=u(!1),w=u(!1),r=u(null),M=e=>{const t=Math.ceil(e/1e3),L=Math.floor(t/60),z=t%60;return`${L}:${z.toString().padStart(2,"0")}`},P=e=>e>=1e4?(e/1e4).toFixed(1)+"万":e.toLocaleString(),R=async()=>{try{const e=await f.getStatus();a.value=e.data}catch(e){g.error(x(e,"获取状态失败"))}},k=async()=>{m.value=!0;try{const e=await f.getTargets(20);y.value=e.data}catch(e){g.error(x(e,"获取目标失败"))}finally{m.value=!1}},T=async()=>{try{const e=await f.getStats();v.value=e.data}catch{}},V=async e=>{if(!(!a.value?.canLoot||_.value)){_.value=!0;try{const t=await f.attack(e);r.value=t.data,w.value=!0,await Promise.all([R(),k(),T()])}catch(t){g.error(x(t,"掠夺失败"))}finally{_.value=!1}}};let S=null;return I(async()=>{await Promise.all([R(),k(),T()]),S=setInterval(()=>{a.value&&!a.value.canLoot&&a.value.cooldownRemaining>0&&(a.value.cooldownRemaining-=1e3,a.value.cooldownRemaining<=0&&(a.value.canLoot=!0,a.value.cooldownRemaining=0))},1e3)}),U(()=>{S&&clearInterval(S)}),(e,t)=>{const L=Y,z=A;return i(),c("div",es,[s("div",as,[s("div",os,[n(l(h),{size:24})]),t[1]||(t[1]=s("div",{class:"header-info"},[s("h2",null,"夺宝"),s("p",null,"掠夺其他修士的灵石资源")],-1))]),s("div",ls,[s("div",ns,[n(l(G),{size:16}),s("span",null,"今日掠夺："+o(a.value?.dailyLoots||0)+" / "+o(a.value?.maxDailyLoots||5),1)]),s("div",{class:b(["status-item",{ready:a.value?.canLoot,cooldown:!a.value?.canLoot}])},[n(l(j),{size:16}),a.value?.canLoot?(i(),c("span",is,"可掠夺")):(i(),c("span",rs,"冷却中 "+o(M(a.value?.cooldownRemaining||0)),1))],2)]),s("div",cs,[s("div",ds,[s("span",us,o(v.value?.value?.toLocaleString()||0),1),t[2]||(t[2]=s("span",{class:"stat-label"},"总掠夺灵石",-1))]),s("div",vs,[s("span",ms,o(v.value?.rank&&v.value.rank>0?`#${v.value.rank}`:"--"),1),t[3]||(t[3]=s("span",{class:"stat-label"},"掠夺榜排名",-1))])]),s("div",ps,[s("div",_s,[s("h3",null,[n(l(X),{size:18}),t[4]||(t[4]=C(" 可掠夺目标 ",-1))]),s("button",{class:"refresh-btn",onClick:k,disabled:m.value},[n(l(Z),{size:14,class:b({spinning:m.value})},null,8,["class"])],8,fs)]),m.value?(i(),c("div",hs,[n(L,{size:"medium"}),t[5]||(t[5]=s("span",null,"搜索目标中...",-1))])):y.value.length===0?(i(),c("div",gs,[n(l(H),{size:48,class:"empty-icon"}),t[6]||(t[6]=s("span",null,"暂无可掠夺的目标",-1))])):(i(),c("div",ys,[(i(!0),c($,null,D(y.value,d=>(i(),c("div",{key:d.id,class:"target-card"},[s("div",ws,[s("div",ks,[C(o(d.name)+" ",1),d.hasFormation?(i(),N(l(F),{key:0,size:12,class:"formation-icon"})):p("",!0)]),s("div",Ss,o(d.realmName),1),d.sectName?(i(),c("div",Ls,o(d.sectName),1)):p("",!0)]),s("div",zs,[s("div",bs,[n(l(J),{size:12}),s("span",null,o(d.power.toLocaleString()),1)]),s("div",Cs,[n(l(h),{size:12}),s("span",null,o(P(d.spiritStones)),1)])]),s("button",{class:"loot-btn",disabled:!a.value?.canLoot||_.value,onClick:As=>V(d.id)},[n(l(K),{size:14}),t[7]||(t[7]=C(" 掠夺 ",-1))],8,xs)]))),128))]))]),n(z,{show:w.value,"onUpdate:show":t[0]||(t[0]=d=>w.value=d),preset:"card",title:"掠夺结果",style:{"max-width":"400px"}},{default:q(()=>[s("div",Rs,[s("div",{class:b(["result-header",r.value?.success?"success":"fail"])},[(i(),N(E(r.value?.success?l(h):l(ts)),{size:48})),s("span",Ts,o(r.value?.success?"掠夺成功":"掠夺失败"),1)],2),s("p",Ns,o(r.value?.message),1),r.value?.success?(i(),c("div",Fs,[n(l(h),{size:20}),s("span",null,"+"+o(r.value?.lootedAmount?.toLocaleString()),1)])):p("",!0),s("div",Ms,[s("div",Ps,[t[8]||(t[8]=s("span",{class:"power-label"},"我方战力",-1)),s("span",Vs,o(r.value?.attackerPower?.toLocaleString()),1)]),t[10]||(t[10]=s("span",{class:"vs"},"VS",-1)),s("div",Bs,[t[9]||(t[9]=s("span",{class:"power-label"},"目标战力",-1)),s("span",Is,o(r.value?.defenderPower?.toLocaleString()),1)])]),r.value?.formationBlocked?(i(),c("div",Us,[n(l(F),{size:16}),t[11]||(t[11]=s("span",null,"目标阵法发动，闪避了攻击！",-1))])):p("",!0),r.value?.success&&r.value?.evilPointsGain>0?(i(),c("div",$s,[n(l(Q),{size:14}),s("span",null,"恶人值 +"+o(r.value.evilPointsGain),1)])):p("",!0)])]),_:1},8,["show"])])}}}),ot=ss(Ds,[["__scopeId","data-v-fe9ebb05"]]);export{ot as default};
