import{a2 as ys,by as S,k as m,e as j,bx as U,f as D,N as _s,c as i,a as s,d as r,F as w,q as I,g as t,p as C,Z as d,s as E,a4 as ds,w as A,B as cs,j as B,n as L,o,S as us,a0 as ms,l as es,a1 as as,bz as M,b as hs}from"./index-DA11XDlS.js";import{H as P}from"./heart-LgXo-eep.js";import{S as G}from"./sparkles-tsZM6BNv.js";import{Z as ss}from"./zap-vMqaBpWc.js";import{c as F}from"./createLucideIcon-DiiZaxVK.js";import{G as ps}from"./gift-BEOm1WG9.js";import{u as J}from"./use-message--i6DiThE.js";import{_ as gs}from"./InputNumber-tuzvZVlG.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as bs}from"./plus-BY3P3rBe.js";import{L as ks}from"./lock-CWZIQcVF.js";import{P as $s}from"./package-CRVIogFf.js";import{T as Cs}from"./triangle-alert-vQJa5xBQ.js";import{S as zs}from"./shield-BMlq6Nq0.js";import{D as ws}from"./droplets-DjVgL-MW.js";import{S as O}from"./star-D9p6u3Oh.js";import{U as ts}from"./users-DzD0wEV-.js";import{C as V}from"./clock-Bnzg_83l.js";import{I as vs}from"./info-qMNw81gd.js";import{U as xs}from"./user-CXIJJnqr.js";import{U as Ss}from"./user-plus-D5P68FjT.js";import{C as Ms}from"./check-Dvn_Mgz0.js";import{E as ns}from"./eye-DNttFUWn.js";import{R as os}from"./refresh-cw-5h0-qbhL.js";import{C as As}from"./coins-Ks2rpWqM.js";import{S as Is}from"./skull-BAbr3491.js";import{C as Rs}from"./cloud-DPpQV0Uw.js";import{S as Ds}from"./sun-CivYJ-dd.js";import{L as Fs}from"./loader-circle-BnoPFgCr.js";import{C as Ps}from"./circle-alert-CQn7xOz3.js";import"./Input-DOOhwlQ-.js";import"./use-locale-EBm6emhn.js";import"./use-merged-state-DvdMjKiF.js";import"./Add-C6IKdIGC.js";const fs=F("circle-dashed",[["path",{d:"M10.1 2.182a10 10 0 0 1 3.8 0",key:"5ilxe3"}],["path",{d:"M13.9 21.818a10 10 0 0 1-3.8 0",key:"11zvb9"}],["path",{d:"M17.609 3.721a10 10 0 0 1 2.69 2.7",key:"1iw5b2"}],["path",{d:"M2.182 13.9a10 10 0 0 1 0-3.8",key:"c0bmvh"}],["path",{d:"M20.279 17.609a10 10 0 0 1-2.7 2.69",key:"1ruxm7"}],["path",{d:"M21.818 10.1a10 10 0 0 1 0 3.8",key:"qkgqxc"}],["path",{d:"M3.721 6.391a10 10 0 0 1 2.7-2.69",key:"1mcia2"}],["path",{d:"M6.391 20.279a10 10 0 0 1-2.69-2.7",key:"1fvljs"}]]);const Ts=F("circle-dot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);const Bs=F("cloud-rain",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]);const Es=F("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);const Gs=F("orbit",[["path",{d:"M20.341 6.484A10 10 0 0 1 10.266 21.85",key:"1enhxb"}],["path",{d:"M3.659 17.516A10 10 0 0 1 13.74 2.152",key:"1crzgf"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["circle",{cx:"19",cy:"5",r:"2",key:"mhkx31"}],["circle",{cx:"5",cy:"19",r:"2",key:"v8kfzx"}]]);const Ns=F("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);const Ls=F("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const Z=F("telescope",[["path",{d:"m10.065 12.493-6.18 1.318a.934.934 0 0 1-1.108-.702l-.537-2.15a1.07 1.07 0 0 1 .691-1.265l13.504-4.44",key:"k4qptu"}],["path",{d:"m13.56 11.747 4.332-.924",key:"19l80z"}],["path",{d:"m16 21-3.105-6.21",key:"7oh9d"}],["path",{d:"M16.485 5.94a2 2 0 0 1 1.455-2.425l1.09-.272a1 1 0 0 1 1.212.727l1.515 6.06a1 1 0 0 1-.727 1.213l-1.09.272a2 2 0 0 1-2.425-1.455z",key:"m7xp4m"}],["path",{d:"m6.158 8.633 1.114 4.456",key:"74o979"}],["path",{d:"m8 21 3.105-6.21",key:"1fvxut"}],["circle",{cx:"12",cy:"13",r:"2",key:"1c1ljs"}]]),js={greetingCooldownHours:24,greetingAffectionGain:5,giftCostBase:100,giftAffectionGain:3,spiritFeedbackCost:500,spiritFeedbackBonus:30,spiritFeedbackDurationMs:36e5,divinationCost:200,maxAffection:100,passiveRedSleeveBonus:10},is={star_essence:{id:"star_essence",name:"星辰精华",description:"凝聚星辰之力形成的基础精华",durationHours:4,yieldItemId:"item_star_essence",yieldMin:2,yieldMax:4,eventChance:.1},star_liquid:{id:"star_liquid",name:"星河灵液",description:"由星河凝聚而成的珍贵灵液",durationHours:8,yieldItemId:"item_star_liquid",yieldMin:1,yieldMax:2,eventChance:.15},star_core:{id:"star_core",name:"星核碎片",description:"远古星辰陨落后的核心碎片，极为珍贵",durationHours:24,yieldItemId:"item_star_core",yieldMin:1,yieldMax:1,eventChance:.2}},rs={none:{id:"none",name:"无",description:"一切正常",effect:"reduce_yield",penalty:0},dim:{id:"dim",name:"星光黯淡",description:"星光逐渐黯淡，产出将会减少",effect:"reduce_yield",penalty:.5},chaos:{id:"chaos",name:"元磁紊乱",description:"元磁场紊乱，凝聚时间将延长",effect:"extend_time",penalty:.3}},ls={great_fortune:{type:"great_fortune",name:"大吉",description:"紫气东来，诸事皆顺",bonus:{cultivation:25,dropRate:10}},fortune:{type:"fortune",name:"吉",description:"今日修炼顺遂",bonus:{cultivation:10}},neutral:{type:"neutral",name:"平",description:"平平无奇"},misfortune:{type:"misfortune",name:"凶",description:"诸事不宜，宜静心修炼",penalty:{cultivation:-10}},great_misfortune:{type:"great_misfortune",name:"大凶",description:"灾星临门，谨慎行事",penalty:{cultivation:-20,eventChance:20}}},H=ys("starpalace",{state:()=>({isStarPalaceMember:!1,consort:null,observatory:null,array:null,stargazeStatus:null,loading:!1,error:null,lastRefresh:0}),getters:{hasConsort(){return this.consort!==null},canGreet(){return this.consort?.canGreet??!1},hasSpiritFeedback(){return this.consort?.spiritFeedbackActive??!1},isConsortAssigned(){return this.consort?.assignedDiskIndex!==null},idleDisks(){return this.observatory?.disks.filter(a=>a.status==="idle"&&!a.isLocked)??[]},gatheringDisks(){return this.observatory?.disks.filter(a=>a.status==="gathering")??[]},readyDisks(){return this.observatory?.disks.filter(a=>a.status==="ready")??[]},eventDisks(){return this.observatory?.disks.filter(a=>a.status==="event")??[]},canInitiateArray(){return this.array?.canInitiate??!1},hasArrayBuff(){return this.array?.hasActiveBuff??!1},canStargaze(){return this.stargazeStatus?.canStargaze??!1},currentStargazeResult(){return this.stargazeStatus?.currentResult??null},canChangeFate(){return this.stargazeStatus?.canChangeFate??!1},freeChangeFateCount(){return this.stargazeStatus?.freeChangeFateCount??0}},actions:{async fetchStatus(a=!1){if(!(!a&&Date.now()-this.lastRefresh<5e3)){this.loading=!0,this.error=null;try{const e=(await S.getStatus()).data;this.isStarPalaceMember=e.isStarPalaceMember,this.consort=e.consort,this.observatory=e.observatory,this.array=e.array,this.stargazeStatus=e.stargaze,this.lastRefresh=Date.now()}catch(n){this.error=m(n),this.isStarPalaceMember=!1,this.consort=null,this.observatory=null,this.array=null,this.stargazeStatus=null}finally{this.loading=!1}}},async greetConsort(){this.loading=!0;try{const a=await S.greetConsort();return this.consort&&(this.consort.affection=a.data.newAffection,this.consort.canGreet=!1,this.consort.greetingCooldownMs=1440*60*1e3),a.data}catch(a){throw this.error=m(a),a}finally{this.loading=!1}},async giftConsort(a){this.loading=!0;try{const n=await S.giftConsort(a);return this.consort&&(this.consort.affection=n.data.newAffection),n.data}catch(n){throw this.error=m(n),n}finally{this.loading=!1}},async spiritFeedback(){this.loading=!0;try{const a=await S.spiritFeedback();return this.consort&&(this.consort.spiritFeedbackActive=!0,this.consort.spiritFeedbackExpiresIn=a.data.expiresIn),a.data}catch(a){throw this.error=m(a),a}finally{this.loading=!1}},async assignConsort(a){this.loading=!0;try{if(await S.assignConsort(a),this.consort&&(this.consort.assignedDiskIndex=a),this.observatory){const n=this.observatory.disks.find(e=>e.diskIndex===a);n&&(n.hasConsortBonus=!0),this.observatory.consortAssignment={consortId:this.consort?.id??null,consortName:this.consort?.name??null,diskIndex:a}}}catch(n){throw this.error=m(n),n}finally{this.loading=!1}},async recallConsort(){this.loading=!0;try{await S.recallConsort();const a=this.consort?.assignedDiskIndex;if(this.consort&&(this.consort.assignedDiskIndex=null),this.observatory&&a!==null&&a!==void 0){const n=this.observatory.disks.find(e=>e.diskIndex===a);n&&(n.hasConsortBonus=!1),this.observatory.consortAssignment={consortId:null,consortName:null,diskIndex:null}}}catch(a){throw this.error=m(a),a}finally{this.loading=!1}},async startGathering(a,n){this.loading=!0;try{const e=await S.startGathering(a,n);if(this.observatory){const _=this.observatory.disks.find(v=>v.diskIndex===a);_&&(_.status="gathering",_.starType=n,_.startedAt=Date.now(),_.readyAt=e.data.readyAt,_.progress=0)}return e.data}catch(e){throw this.error=m(e),e}finally{this.loading=!1}},async collectDisk(a){this.loading=!0;try{const n=await S.collectDisk(a);if(this.observatory){const e=this.observatory.disks.find(_=>_.diskIndex===a);e&&(e.status="idle",e.starType=null,e.startedAt=null,e.readyAt=null,e.progress=0,e.eventType="none")}return n.data}catch(n){throw this.error=m(n),n}finally{this.loading=!1}},async handleDiskEvent(a){this.loading=!0;try{const n=await S.handleDiskEvent(a);if(this.observatory){const e=this.observatory.disks.find(_=>_.diskIndex===a);e&&(e.status="gathering",e.eventType="none")}return n.data}catch(n){throw this.error=m(n),n}finally{this.loading=!1}},async expandDisks(){this.loading=!0;try{const a=await S.expandDisks();return await this.fetchStatus(!0),a.data}catch(a){throw this.error=m(a),a}finally{this.loading=!1}},async initiateArray(){this.loading=!0;try{const a=await S.initiateArray();return await this.fetchStatus(!0),a.data}catch(a){throw this.error=m(a),a}finally{this.loading=!1}},async joinArray(a){this.loading=!0;try{const n=await S.joinArray(a);return await this.fetchStatus(!0),n.data}catch(n){throw this.error=m(n),n}finally{this.loading=!1}},async doStargaze(){this.loading=!0;try{const a=await S.stargaze();if(this.stargazeStatus){const n=a.data.result;this.stargazeStatus.currentResult=ls[n],this.stargazeStatus.canStargaze=!1,this.stargazeStatus.stargazeCooldownMs=1440*60*1e3}return a.data}catch(a){throw this.error=m(a),a}finally{this.loading=!1}},async changeFate(){this.loading=!0;try{const a=await S.changeFate();if(this.stargazeStatus){const n=a.data.newResult;this.stargazeStatus.currentResult=ls[n],this.stargazeStatus.canChangeFate=!1,this.stargazeStatus.freeChangeFateCount>0&&this.stargazeStatus.freeChangeFateCount--}return a.data}catch(a){throw this.error=m(a),a}finally{this.loading=!1}},reset(){this.isStarPalaceMember=!1,this.consort=null,this.observatory=null,this.array=null,this.stargazeStatus=null,this.loading=!1,this.error=null,this.lastRefresh=0},updateDiskProgress(){if(!this.observatory)return;const a=Date.now();for(const n of this.observatory.disks)if(n.status==="gathering"&&n.startedAt&&n.readyAt){const e=n.readyAt-n.startedAt,_=a-n.startedAt;n.progress=Math.min(100,_/e*100),a>=n.readyAt&&(n.status="ready",n.progress=100)}}},persist:{key:"starpalace",pick:["isStarPalaceMember","lastRefresh"]}}),Us={class:"consort-panel"},qs={class:"heart-particles"},Hs={key:0,class:"no-consort"},Os={class:"consort-card"},Vs={class:"consort-avatar"},Zs={class:"consort-info"},Js={class:"consort-name"},Ks={class:"name"},Ys={class:"title"},Qs={class:"consort-personality"},Ws={class:"consort-desc"},Xs={class:"affection-section"},st={class:"section-header"},tt={class:"affection-level"},et={class:"affection-bar"},at={class:"affection-info"},nt={class:"bonus"},ot={class:"skill-card"},it={class:"skill-header"},rt={class:"skill-desc"},lt={key:0,class:"buff-active"},dt={class:"buff-time"},ct={key:1,class:"assigned-info"},ut={class:"actions"},ht=["disabled"],pt={key:0},vt={key:1},ft=["disabled"],yt=["disabled"],_t=["disabled"],mt=["disabled"],gt={class:"gift-dialog"},bt={class:"gift-input"},kt={class:"gift-cost"},$t={class:"assign-dialog"},Ct={class:"disk-options"},zt=["onClick"],wt=j({__name:"ConsortPanel",setup(a){const n=H(),{consort:e,observatory:_,loading:v}=U(n),g=J(),x=D(!1),f=D(!1),z=D(1),b=D(null),l=_s(()=>_.value?.disks.filter(k=>!k.isLocked&&!k.hasConsortBonus)??[]);function u(k){if(k<=0)return"可用";const c=Math.floor(k/(3600*1e3)),T=Math.floor(k%(3600*1e3)/(60*1e3));return c>0?`${c}时${T}分`:`${T}分钟`}async function R(){try{const k=await n.greetConsort();g.success(k.message)}catch(k){g.error(m(k,"问安失败"))}}async function K(){try{const k=await n.giftConsort(z.value);g.success(`赠予成功，好感度+${k.affectionGained}`),x.value=!1,z.value=1}catch(k){g.error(m(k,"赠予失败"))}}async function Y(){try{await n.spiritFeedback(),g.success(`灵力反哺成功，修炼加成+${js.spiritFeedbackBonus}%，持续1小时`)}catch(k){g.error(m(k,"灵力反哺失败"))}}async function Q(){if(b.value!==null)try{await n.assignConsort(b.value),g.success("侍妾已派遣"),f.value=!1,b.value=null}catch(k){g.error(m(k,"派遣失败"))}}async function W(){try{await n.recallConsort(),g.success("侍妾已召回")}catch(k){g.error(m(k,"召回失败"))}}return(k,c)=>{const T=gs,y=cs,p=ds;return o(),i("div",Us,[s("div",qs,[(o(),i(w,null,I(12,$=>s("div",{key:$,class:"heart-particle",style:E({"--delay":Math.random()*6+"s","--x":Math.random()*100+"%","--duration":Math.random()*4+4+"s"})}," ♥ ",4)),64))]),t(e)?(o(),i(w,{key:1},[s("div",Os,[s("div",Vs,[r(t(P),{size:32})]),s("div",Zs,[s("div",Js,[s("span",Ks,d(t(e).name),1),s("span",Ys,d(t(e).title),1)]),s("div",Qs,d(t(e).personality),1),s("div",Ws,d(t(e).description),1)])]),s("div",Xs,[s("div",st,[r(t(P),{size:18}),c[8]||(c[8]=s("span",null,"好感度",-1)),s("span",tt,d(t(e).affectionLevel.name),1)]),s("div",et,[s("div",{class:"affection-fill",style:E({width:t(e).affection+"%"})},null,4)]),s("div",at,[s("span",null,d(t(e).affection)+"/100",1),s("span",nt,"修炼加成 +"+d(t(e).cultivationBonus)+"%",1)])]),s("div",ot,[s("div",it,[r(t(G),{size:18}),s("span",null,d(t(e).specialSkill.name),1)]),s("div",rt,d(t(e).specialSkill.description),1)]),t(e).spiritFeedbackActive?(o(),i("div",lt,[r(t(ss),{size:18}),c[9]||(c[9]=s("span",null,"灵力反哺生效中",-1)),s("span",dt,"剩余 "+d(u(t(e).spiritFeedbackExpiresIn)),1)])):C("",!0),t(e).assignedDiskIndex!==null?(o(),i("div",ct,[r(t(Z),{size:18}),s("span",null,"已派遣至引星盘 #"+d(t(e).assignedDiskIndex+1),1)])):C("",!0),s("div",ut,[s("button",{class:"action-btn greet",disabled:!t(e).canGreet||t(v),onClick:R},[r(t(Es),{size:18}),t(e).canGreet?(o(),i("span",pt,"每日问安")):(o(),i("span",vt,d(u(t(e).greetingCooldownMs)),1))],8,ht),s("button",{class:"action-btn gift",disabled:t(v),onClick:c[0]||(c[0]=$=>x.value=!0)},[r(t(ps),{size:18}),c[10]||(c[10]=s("span",null,"赠予侍妾",-1))],8,ft),s("button",{class:"action-btn feedback",disabled:t(e).spiritFeedbackActive||t(v),onClick:Y},[r(t(ss),{size:18}),c[11]||(c[11]=s("span",null,"灵力反哺",-1))],8,yt),t(e).assignedDiskIndex===null?(o(),i("button",{key:0,class:"action-btn assign",disabled:t(v),onClick:c[1]||(c[1]=$=>f.value=!0)},[r(t(Ls),{size:18}),c[12]||(c[12]=s("span",null,"派遣侍妾",-1))],8,_t)):(o(),i("button",{key:1,class:"action-btn recall",disabled:t(v),onClick:W},[r(t(Ns),{size:18}),c[13]||(c[13]=s("span",null,"召回侍妾",-1))],8,mt))])],64)):(o(),i("div",Hs,[r(t(P),{size:48}),c[7]||(c[7]=s("p",null,"暂无侍妾",-1))])),r(p,{show:x.value,"onUpdate:show":c[4]||(c[4]=$=>x.value=$),preset:"dialog",title:"赠予侍妾"},{default:A(()=>[s("div",gt,[c[15]||(c[15]=s("p",null,"消耗灵石赠予侍妾，增加好感度",-1)),s("div",bt,[c[14]||(c[14]=s("span",null,"赠予数量:",-1)),r(T,{value:z.value,"onUpdate:value":c[2]||(c[2]=$=>z.value=$),min:1,max:10},null,8,["value"])]),s("div",kt,"消耗: "+d(z.value*100)+" 灵石，好感度+"+d(z.value*3),1)])]),action:A(()=>[r(y,{onClick:c[3]||(c[3]=$=>x.value=!1)},{default:A(()=>[...c[16]||(c[16]=[B("取消",-1)])]),_:1}),r(y,{type:"primary",loading:t(v),onClick:K},{default:A(()=>[...c[17]||(c[17]=[B("确认赠予",-1)])]),_:1},8,["loading"])]),_:1},8,["show"]),r(p,{show:f.value,"onUpdate:show":c[6]||(c[6]=$=>f.value=$),preset:"dialog",title:"派遣侍妾"},{default:A(()=>[s("div",$t,[c[18]||(c[18]=s("p",null,"选择要派遣的引星盘，侍妾将增加15%产出",-1)),s("div",Ct,[(o(!0),i(w,null,I(l.value,$=>(o(),i("div",{key:$.diskIndex,class:L(["disk-option",{selected:b.value===$.diskIndex}]),onClick:N=>b.value=$.diskIndex},[r(t(Z),{size:20}),s("span",null,"引星盘 #"+d($.diskIndex+1),1)],10,zt))),128))])])]),action:A(()=>[r(y,{onClick:c[5]||(c[5]=$=>f.value=!1)},{default:A(()=>[...c[19]||(c[19]=[B("取消",-1)])]),_:1}),r(y,{type:"primary",disabled:b.value===null,loading:t(v),onClick:Q},{default:A(()=>[...c[20]||(c[20]=[B("确认派遣",-1)])]),_:1},8,["disabled","loading"])]),_:1},8,["show"])])}}}),xt=q(wt,[["__scopeId","data-v-a7c397b7"]]),St={class:"observatory-panel"},Mt={class:"stardust-particles"},At={class:"observatory-header"},It={class:"disk-count"},Rt=["disabled"],Dt={class:"disks-grid"},Ft={class:"disk-header"},Pt={class:"disk-index"},Tt={key:0,class:"consort-badge"},Bt={class:"disk-idle"},Et=["onClick"],Gt={class:"disk-header"},Nt={class:"disk-index"},Lt={key:0,class:"consort-badge"},jt={class:"gathering-info"},Ut={class:"star-name"},qt={class:"progress-ring"},Ht={viewBox:"0 0 60 60"},Ot=["stroke-dashoffset"],Vt={class:"progress-text"},Zt={class:"time-remaining"},Jt={class:"disk-header"},Kt={class:"disk-index"},Yt={key:0,class:"consort-badge"},Qt={class:"ready-info"},Wt={class:"star-name"},Xt=["disabled","onClick"],se={class:"disk-header"},te={class:"disk-index"},ee={class:"event-info"},ae={class:"event-name"},ne={class:"event-desc"},oe=["disabled","onClick"],ie={class:"start-dialog"},re={class:"star-options"},le=["onClick"],de={class:"star-icon"},ce={class:"star-info"},ue={class:"star-name"},he={class:"star-duration"},pe={class:"star-yield"},ve=j({__name:"ObservatoryPanel",setup(a){const n=H(),{observatory:e,loading:_}=U(n),v=J(),g=D(!1),x=D(null),f=D(null),z=Object.values(is);let b=null;us(()=>{b=setInterval(()=>{n.updateDiskProgress()},1e3)}),ms(()=>{b&&clearInterval(b)});function l(y){return y?is[y]?.name??y:""}function u(y){return{star_essence:M(O),star_liquid:M(ws),star_core:M(Ts)}[y]??M(O)}function R(y){return rs[y]?.name??y}function K(y){return rs[y]?.description??""}function Y(y){if(!y.readyAt)return"";const p=y.readyAt-Date.now();if(p<=0)return"即将完成";const $=Math.floor(p/(3600*1e3)),N=Math.floor(p%(3600*1e3)/(60*1e3));return $>0?`${$}时${N}分`:`${N}分钟`}function Q(y){x.value=y,f.value=null,g.value=!0}async function W(){if(!(x.value===null||!f.value))try{await n.startGathering(x.value,f.value),v.success("开始凝聚星辰"),g.value=!1}catch(y){v.error(m(y,"开始凝聚失败"))}}async function k(y){try{const p=await n.collectDisk(y);v.success(`收获: ${p.itemName} x${p.quantity}`)}catch(p){v.error(m(p,"收取失败"))}}async function c(y){try{await n.handleDiskEvent(y),v.success("星辰已安抚")}catch(p){v.error(m(p,"安抚失败"))}}async function T(){try{await n.expandDisks(),v.success("引星盘扩展成功")}catch(y){v.error(m(y,"扩展失败"))}}return(y,p)=>{const $=cs,N=ds;return o(),i("div",St,[s("div",Mt,[(o(),i(w,null,I(20,h=>s("div",{key:h,class:"stardust",style:E({"--delay":Math.random()*8+"s","--x":Math.random()*100+"%","--size":Math.random()*4+2+"px","--duration":Math.random()*5+5+"s"})},null,4)),64))]),s("div",At,[s("div",It,[r(t(Z),{size:20}),s("span",null,"引星盘: "+d(t(e)?.unlockedDisks??0)+"/"+d(t(e)?.maxDisks??6),1)]),t(e)?.canExpand?(o(),i("button",{key:0,class:"expand-btn",disabled:t(_),onClick:T},[r(t(bs),{size:16}),s("span",null,"扩展 ("+d(t(e)?.expansionCost)+"贡献)",1)],8,Rt)):C("",!0)]),s("div",Dt,[(o(!0),i(w,null,I(t(e)?.disks??[],h=>(o(),i("div",{key:h.diskIndex,class:L(["disk-card",{locked:h.isLocked,hasEvent:h.status==="event"}])},[h.isLocked?(o(),i(w,{key:0},[r(t(ks),{size:32}),p[2]||(p[2]=s("span",{class:"locked-text"},"未解锁",-1))],64)):h.status==="idle"?(o(),i(w,{key:1},[s("div",Ft,[s("span",Pt,"#"+d(h.diskIndex+1),1),h.hasConsortBonus?(o(),i("span",Tt,[r(t(P),{size:12})])):C("",!0)]),s("div",Bt,[r(t(fs),{size:40}),p[3]||(p[3]=s("span",null,"空闲中",-1))]),s("button",{class:"start-btn",onClick:X=>Q(h.diskIndex)},"开始凝聚",8,Et)],64)):h.status==="gathering"?(o(),i(w,{key:2},[s("div",Gt,[s("span",Nt,"#"+d(h.diskIndex+1),1),h.hasConsortBonus?(o(),i("span",Lt,[r(t(P),{size:12})])):C("",!0)]),s("div",jt,[s("div",Ut,d(l(h.starType)),1),s("div",qt,[(o(),i("svg",Ht,[p[4]||(p[4]=s("circle",{class:"bg",cx:"30",cy:"30",r:"26"},null,-1)),s("circle",{class:"fill",cx:"30",cy:"30",r:"26","stroke-dasharray":163.36,"stroke-dashoffset":163.36*(1-(h.progress||0)/100)},null,8,Ot)])),s("span",Vt,d(Math.floor(h.progress||0))+"%",1)]),s("div",Zt,d(Y(h)),1)])],64)):h.status==="ready"?(o(),i(w,{key:3},[s("div",Jt,[s("span",Kt,"#"+d(h.diskIndex+1),1),h.hasConsortBonus?(o(),i("span",Yt,[r(t(P),{size:12})])):C("",!0)]),s("div",Qt,[r(t(G),{size:40,class:"ready-icon"}),s("span",Wt,d(l(h.starType)),1),p[5]||(p[5]=s("span",{class:"ready-text"},"凝聚完成",-1))]),s("button",{class:"collect-btn",disabled:t(_),onClick:X=>k(h.diskIndex)},[r(t($s),{size:16}),p[6]||(p[6]=s("span",null,"收取",-1))],8,Xt)],64)):h.status==="event"?(o(),i(w,{key:4},[s("div",se,[s("span",te,"#"+d(h.diskIndex+1),1),r(t(Cs),{size:16,class:"event-icon"})]),s("div",ee,[s("div",ae,d(R(h.eventType)),1),s("div",ne,d(K(h.eventType)),1)]),s("button",{class:"handle-btn",disabled:t(_),onClick:X=>c(h.diskIndex)},[r(t(zs),{size:16}),p[7]||(p[7]=s("span",null,"安抚星辰",-1))],8,oe)],64)):C("",!0)],2))),128))]),r(N,{show:g.value,"onUpdate:show":p[1]||(p[1]=h=>g.value=h),preset:"dialog",title:"选择凝聚星辰"},{default:A(()=>[s("div",ie,[p[8]||(p[8]=s("p",null,"选择要凝聚的星辰类型",-1)),s("div",re,[(o(!0),i(w,null,I(t(z),h=>(o(),i("div",{key:h.id,class:L(["star-option",{selected:f.value===h.id}]),onClick:X=>f.value=h.id},[s("div",de,[(o(),es(as(u(h.id)),{size:24}))]),s("div",ce,[s("div",ue,d(h.name),1),s("div",he,d(h.durationHours)+"小时",1),s("div",pe,"产出: "+d(h.yieldMin)+"-"+d(h.yieldMax),1)])],10,le))),128))])])]),action:A(()=>[r($,{onClick:p[0]||(p[0]=h=>g.value=!1)},{default:A(()=>[...p[9]||(p[9]=[B("取消",-1)])]),_:1}),r($,{type:"primary",disabled:!f.value,loading:t(_),onClick:W},{default:A(()=>[...p[10]||(p[10]=[B("开始凝聚",-1)])]),_:1},8,["disabled","loading"])]),_:1},8,["show"])])}}}),fe=q(ve,[["__scopeId","data-v-0a83c9ed"]]),ye={class:"star-array-panel"},_e={class:"array-particles"},me={class:"personal-status"},ge={class:"status-header"},be={key:0,class:"buff-card"},ke={class:"buff-icon"},$e={class:"buff-info"},Ce={class:"buff-title"},ze={class:"buff-role"},we={class:"buff-bonus"},xe={class:"buff-time"},Se={key:1,class:"cooldown-info"},Me=["disabled"],Ae={class:"array-info"},Ie={class:"info-header"},Re={class:"active-arrays"},De={class:"section-header"},Fe={key:0,class:"no-arrays"},Pe={key:1,class:"arrays-list"},Te={class:"array-info-row"},Be={class:"initiator"},Ee={class:"participants"},Ge={class:"array-time"},Ne=["disabled","onClick"],Le={key:1,class:"already-joined"},je=j({__name:"StarArrayPanel",setup(a){const n=H(),{array:e,loading:_}=U(n),v=J();function g(b){if(b<=0)return"可用";const l=Math.floor(b/(3600*1e3)),u=Math.floor(b%(3600*1e3)/(60*1e3));return l>0?`${l}时${u}分`:`${u}分钟`}function x(b){const l=b-Date.now();return g(l)}async function f(){try{await n.initiateArray(),v.success("周天星斗大阵已启动！获得3小时强力加成")}catch(b){v.error(m(b,"启阵失败"))}}async function z(b){try{await n.joinArray(b),v.success("助阵成功！获得3小时修炼加成")}catch(l){v.error(m(l,"助阵失败"))}}return(b,l)=>(o(),i("div",ye,[s("div",_e,[(o(),i(w,null,I(18,u=>s("div",{key:u,class:"array-star",style:E({"--delay":Math.random()*6+"s","--x":Math.random()*100+"%","--y":Math.random()*100+"%","--size":Math.random()*4+2+"px","--duration":Math.random()*4+3+"s"})},null,4)),64))]),s("div",me,[s("div",ge,[r(t(ts),{size:20}),l[0]||(l[0]=s("span",null,"周天星斗大阵",-1))]),l[3]||(l[3]=s("p",{class:"status-desc"},"与同门联手布阵，获得强大的修炼加成",-1)),t(e)?.hasActiveBuff?(o(),i("div",be,[s("div",ke,[r(t(ss),{size:24})]),s("div",$e,[s("div",Ce,[l[1]||(l[1]=s("span",null,"大阵效果生效中",-1)),s("span",ze,d(t(e).isInitiator?"(阵眼)":"(助阵)"),1)]),s("div",we,[s("span",null,"成功率: "+d(t(e).bonus.successRate)+"%",1),s("span",null,"产出加成: +"+d(t(e).bonus.yieldBonus)+"%",1)]),s("div",xe,"剩余: "+d(g(t(e).buffExpiresIn)),1)])])):C("",!0),!t(e)?.canInitiate&&t(e)?.cooldownMs?(o(),i("div",Se,[r(t(V),{size:16}),s("span",null,"大阵冷却中: "+d(g(t(e).cooldownMs)),1)])):C("",!0),t(e)?.canInitiate?(o(),i("button",{key:2,class:"initiate-btn",disabled:t(_),onClick:f},[r(t(G),{size:18}),l[2]||(l[2]=s("span",null,"启阵",-1))],8,Me)):C("",!0)]),s("div",Ae,[s("div",Ie,[r(t(vs),{size:18}),l[4]||(l[4]=s("span",null,"大阵效果",-1))]),l[5]||(l[5]=hs('<div class="info-grid" data-v-10e3e565><div class="info-item" data-v-10e3e565><div class="role" data-v-10e3e565>阵眼(发起者)</div><div class="bonus" data-v-10e3e565>成功率 98%</div><div class="bonus" data-v-10e3e565>产出 +50%</div></div><div class="info-item" data-v-10e3e565><div class="role" data-v-10e3e565>助阵者</div><div class="bonus" data-v-10e3e565>成功率 80%</div><div class="bonus" data-v-10e3e565>产出 +30%</div></div></div><div class="info-note" data-v-10e3e565><span data-v-10e3e565>持续3小时 · 冷却12小时 · 最多10人</span></div>',2))]),s("div",Re,[s("div",De,[r(t(Gs),{size:18}),l[6]||(l[6]=s("span",null,"当前活跃大阵",-1))]),t(e)?.activeArrays?.length?(o(),i("div",Pe,[(o(!0),i(w,null,I(t(e).activeArrays,u=>(o(),i("div",{key:u.id,class:"array-card"},[s("div",Te,[s("div",Be,[r(t(xs),{size:16}),s("span",null,d(u.initiatorName),1)]),s("div",Ee,[r(t(ts),{size:14}),s("span",null,d(u.participantCount)+"/10",1)])]),s("div",Ge,[r(t(V),{size:14}),s("span",null,"剩余: "+d(x(u.expiresAt)),1)]),u.canJoin?(o(),i("button",{key:0,class:"join-btn",disabled:t(_),onClick:R=>z(u.id)},[r(t(Ss),{size:16}),l[8]||(l[8]=s("span",null,"助阵",-1))],8,Ne)):(o(),i("div",Le,[r(t(Ms),{size:16}),l[9]||(l[9]=s("span",null,"已参与",-1))]))]))),128))])):(o(),i("div",Fe,[r(t(fs),{size:32}),l[7]||(l[7]=s("span",null,"暂无活跃大阵",-1))]))])]))}}),Ue=q(je,[["__scopeId","data-v-10e3e565"]]),qe={class:"stargaze-panel"},He={class:"fate-particles"},Oe={class:"stargaze-card"},Ve={class:"card-header"},Ze={class:"result-icon"},Je={class:"result-info"},Ke={class:"result-name"},Ye={class:"result-desc"},Qe={key:0,class:"result-bonus"},We={key:0},Xe={key:1},sa={key:1,class:"result-penalty"},ta={key:0},ea={key:1},aa={key:1,class:"no-result"},na={key:2,class:"cooldown-info"},oa=["disabled"],ia={class:"change-fate-card"},ra={class:"card-header"},la={class:"fate-info"},da={class:"cost-info"},ca={key:0,class:"free-count"},ua={key:0,class:"cooldown-info"},ha=["disabled"],pa={class:"probability-info"},va={class:"info-header"},fa=j({__name:"StargazePanel",setup(a){const n=H(),{stargazeStatus:e,loading:_}=U(n),v=J();function g(l){if(l<=0)return"可用";const u=Math.floor(l/(3600*1e3)),R=Math.floor(l%(3600*1e3)/(60*1e3));return u>0?`${u}时${R}分`:`${R}分钟`}function x(l){return l.replace("_","-")}function f(l){return{great_fortune:M(Ds),fortune:M(O),neutral:M(Rs),misfortune:M(Bs),great_misfortune:M(Is)}[l]??M(O)}async function z(){try{const l=await n.doStargaze();v.success(`观星结果: ${l.result.name} - ${l.result.description}`)}catch(l){v.error(m(l,"观星失败"))}}async function b(){try{const l=await n.changeFate();v.success(`命运已改变: ${l.newResult.name}`)}catch(l){v.error(m(l,"改命失败"))}}return(l,u)=>(o(),i("div",qe,[s("div",He,[(o(),i(w,null,I(15,R=>s("div",{key:R,class:"fate-star",style:E({"--delay":Math.random()*5+"s","--x":Math.random()*100+"%","--y":Math.random()*100+"%","--size":Math.random()*3+2+"px","--duration":Math.random()*3+3+"s"})},null,4)),64))]),s("div",Oe,[s("div",Ve,[r(t(G),{size:20}),u[0]||(u[0]=s("span",null,"星衍天机",-1))]),u[3]||(u[3]=s("p",{class:"card-desc"},"观察星象变化，预知今日命运",-1)),t(e)?.currentResult?(o(),i("div",{key:0,class:L(["result-card",x(t(e).currentResult.type)])},[s("div",Ze,[(o(),es(as(f(t(e).currentResult.type)),{size:32}))]),s("div",Je,[s("div",Ke,d(t(e).currentResult.name),1),s("div",Ye,d(t(e).currentResult.description),1),t(e).currentResult.bonus?(o(),i("div",Qe,[t(e).currentResult.bonus.cultivation?(o(),i("span",We,"修炼 +"+d(t(e).currentResult.bonus.cultivation)+"%",1)):C("",!0),t(e).currentResult.bonus.dropRate?(o(),i("span",Xe,"掉落 +"+d(t(e).currentResult.bonus.dropRate)+"%",1)):C("",!0)])):C("",!0),t(e).currentResult.penalty?(o(),i("div",sa,[t(e).currentResult.penalty.cultivation?(o(),i("span",ta," 修炼 "+d(t(e).currentResult.penalty.cultivation)+"% ",1)):C("",!0),t(e).currentResult.penalty.eventChance?(o(),i("span",ea," 事件 +"+d(t(e).currentResult.penalty.eventChance)+"% ",1)):C("",!0)])):C("",!0)])],2)):(o(),i("div",aa,[r(t(ns),{size:48}),u[1]||(u[1]=s("span",null,"今日尚未观星",-1))])),t(e)&&!t(e).canStargaze&&t(e).currentResult?(o(),i("div",na,[r(t(V),{size:16}),s("span",null,"下次观星: "+d(g(t(e).stargazeCooldownMs)),1)])):C("",!0),t(e)?.canStargaze?(o(),i("button",{key:3,class:"stargaze-btn",disabled:t(_),onClick:z},[r(t(ns),{size:18}),u[2]||(u[2]=s("span",null,"观星",-1))],8,oa)):C("",!0)]),s("div",ia,[s("div",ra,[r(t(os),{size:20}),u[4]||(u[4]=s("span",null,"改换星移",-1))]),u[7]||(u[7]=s("p",{class:"card-desc"},"消耗资源重新占卜，改变命运走向",-1)),s("div",la,[s("div",da,[r(t(As),{size:16}),u[5]||(u[5]=s("span",null,"消耗: 1000 灵石",-1))]),t(e)?.freeChangeFateCount?(o(),i("div",ca,[r(t(ps),{size:16}),s("span",null,"免费次数: "+d(t(e).freeChangeFateCount),1)])):C("",!0)]),t(e)&&!t(e).canChangeFate&&t(e).changeFateCooldownMs>0?(o(),i("div",ua,[r(t(V),{size:16}),s("span",null,"改命冷却: "+d(g(t(e).changeFateCooldownMs)),1)])):C("",!0),s("button",{class:"change-fate-btn",disabled:!t(e)?.canChangeFate||t(_),onClick:b},[r(t(os),{size:18}),u[6]||(u[6]=s("span",null,"改换星移",-1))],8,ha)]),s("div",pa,[s("div",va,[r(t(vs),{size:16}),u[8]||(u[8]=s("span",null,"观星结果分布",-1))]),u[9]||(u[9]=hs('<div class="prob-grid" data-v-83ab960b><div class="prob-item great-fortune" data-v-83ab960b><span class="prob-name" data-v-83ab960b>大吉</span><span class="prob-value" data-v-83ab960b>5%</span></div><div class="prob-item fortune" data-v-83ab960b><span class="prob-name" data-v-83ab960b>吉</span><span class="prob-value" data-v-83ab960b>25%</span></div><div class="prob-item neutral" data-v-83ab960b><span class="prob-name" data-v-83ab960b>平</span><span class="prob-value" data-v-83ab960b>40%</span></div><div class="prob-item misfortune" data-v-83ab960b><span class="prob-name" data-v-83ab960b>凶</span><span class="prob-value" data-v-83ab960b>25%</span></div><div class="prob-item great-misfortune" data-v-83ab960b><span class="prob-name" data-v-83ab960b>大凶</span><span class="prob-value" data-v-83ab960b>5%</span></div></div>',1))])]))}}),ya=q(fa,[["__scopeId","data-v-83ab960b"]]),_a={class:"star-palace"},ma={class:"starfield"},ga={class:"page-header"},ba={class:"header-icon"},ka={key:0,class:"loading-container"},$a={key:1,class:"not-member"},Ca={class:"tab-container"},za=["onClick"],wa={key:0,class:"tab-content"},xa={key:1,class:"tab-content"},Sa={key:2,class:"tab-content"},Ma={key:3,class:"tab-content"},Aa=j({__name:"StarPalace",setup(a){const n=H(),{loading:e,isStarPalaceMember:_}=U(n),v=D("consort"),g=[{id:"consort",name:"道心侍妾",icon:M(P)},{id:"observatory",name:"观星台",icon:M(Z)},{id:"array",name:"星斗大阵",icon:M(ts)},{id:"stargaze",name:"星衍天机",icon:M(G)}];return us(async()=>{try{await n.fetchStatus(!0)}catch(x){console.error("初始化星宫系统失败:",x)}}),(x,f)=>(o(),i("div",_a,[s("div",ma,[(o(),i(w,null,I(30,z=>s("div",{key:z,class:"star",style:E({"--delay":Math.random()*5+"s","--x":Math.random()*100+"%","--y":Math.random()*100+"%","--size":Math.random()*3+1+"px","--duration":Math.random()*3+2+"s"})},null,4)),64))]),s("div",ga,[s("div",ba,[f[0]||(f[0]=s("div",{class:"header-icon-glow"},null,-1)),f[1]||(f[1]=s("div",{class:"header-icon-ring"},null,-1)),r(t(G),{size:24})]),f[2]||(f[2]=s("div",{class:"header-text"},[s("h1",null,"星宫秘法"),s("p",null,"道心侍妾，引星凝灵")],-1))]),t(e)?(o(),i("div",ka,[r(t(Fs),{size:32,class:"spin"}),f[3]||(f[3]=s("span",null,"正在感应星辰...",-1))])):t(_)?(o(),i(w,{key:2},[s("div",Ca,[(o(),i(w,null,I(g,z=>s("div",{key:z.id,class:L(["tab-item",{active:v.value===z.id}]),onClick:b=>v.value=z.id},[(o(),es(as(z.icon),{size:18})),s("span",null,d(z.name),1)],10,za)),64))]),v.value==="consort"?(o(),i("div",wa,[r(xt)])):v.value==="observatory"?(o(),i("div",xa,[r(fe)])):v.value==="array"?(o(),i("div",Sa,[r(Ue)])):v.value==="stargaze"?(o(),i("div",Ma,[r(ya)])):C("",!0)],64)):(o(),i("div",$a,[r(t(Ps),{size:48}),f[4]||(f[4]=s("h2",null,"无法参悟",-1)),f[5]||(f[5]=s("p",null,"只有星宫弟子才能修习星宫秘法",-1))]))]))}}),un=q(Aa,[["__scopeId","data-v-c279daa0"]]);export{un as default};
