import{a2 as A,cB as w,k as D,e as V,bx as E,f as k,S as U,c as o,a as e,d as n,g as a,F as p,p as c,Z as r,n as v,q as R,j as T,w as j,a4 as X,l as Z,a1 as G,o as l}from"./index-DA11XDlS.js";import{F as g}from"./flame-DuW_991e.js";import{L as H}from"./loader-Bk8qWIrR.js";import{C as J}from"./circle-alert-CQn7xOz3.js";import{S as K}from"./swords-bfqjVPqN.js";import{S as O}from"./sparkles-tsZM6BNv.js";import{T as q}from"./triangle-alert-vQJa5xBQ.js";import{C as Q}from"./clock-Bnzg_83l.js";import{C as I}from"./circle-check-big-B5OYv702.js";import{C as S}from"./circle-x-B-Ydbwdk.js";import{T as L}from"./target-CxCFSND-.js";import{C as $}from"./coins-Ks2rpWqM.js";import{S as M}from"./sword-BlVHvUf1.js";import{A as W}from"./award-B0i9BiiK.js";import{C as Y,T as ee}from"./trending-down-vetOgy17.js";import{u as se}from"./use-message--i6DiThE.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createLucideIcon-DiiZaxVK.js";const te=A("flameFan",{state:()=>({status:null,loading:!1,error:null,lastRefresh:0}),getters:{hasThreeFlameFan(){return this.status?.hasThreeFlameFan??!1},hasSevenFlameFan(){return this.status?.hasSevenFlameFan??!1},equippedFlameFan(){return this.status?.equippedFlameFan??null},combatPower(){return this.status?.combatPower??0},fireResonance(){return this.status?.fireResonance??null},debuff(){return this.status?.debuff??null},equippedFanName(){return this.status?.equippedFlameFan?this.status.equippedFlameFan==="three_flame_fan"?"三焰扇":"七焰扇":"未装备"},resonanceTypeName(){return this.status?.fireResonance?.hasResonance?this.status.fireResonance.type==="full"?"完全共鸣":"部分共鸣":"无共鸣"}},actions:{async fetchStatus(h=!1){if(!(!h&&Date.now()-this.lastRefresh<5e3)){this.loading=!0,this.error=null;try{const d=await w.getStatus();this.status=d.data,this.lastRefresh=Date.now()}catch(d){this.error=D(d,"获取七焰扇状态失败")}finally{this.loading=!1}}},async craft(h){this.loading=!0;try{const f=(await w.craft(h)).data;return await this.fetchStatus(!0),f}finally{this.loading=!1}},async equip(h){this.loading=!0;try{const f=(await w.equip(h)).data;return await this.fetchStatus(!0),f}finally{this.loading=!1}},async unequip(){this.loading=!0;try{const d=(await w.unequip()).data;return await this.fetchStatus(!0),d}finally{this.loading=!1}}}}),ne={class:"flame-fan-page"},le={class:"page-header"},oe={class:"header-icon"},ie={key:0,class:"loading-state"},re={key:1,class:"error-state"},ue={class:"status-card"},de={class:"status-header"},ce={key:0,class:"combat-power"},fe={class:"equipment-info"},pe={class:"fan-slot"},me={class:"slot-info"},ve={key:0,class:"resonance-info"},he={class:"resonance-bonus"},_e={key:0,class:"equip-actions"},Fe=["disabled"],ge=["disabled"],ye=["disabled"],be={key:0,class:"debuff-card"},we={class:"debuff-header"},ke={class:"debuff-desc"},qe={class:"debuff-effects"},Se={class:"debuff-timer"},Ce={class:"owned-fans"},ze={class:"fans-grid"},Re={class:"fan-header"},Te={class:"fan-icon"},Ie={class:"fan-status"},Le={class:"fan-header"},$e={class:"fan-icon"},Me={class:"fan-status"},Ne={class:"crafting-section"},xe={key:0,class:"craft-card"},Be={class:"craft-header"},Pe={class:"craft-title"},Ae={class:"success-rate"},De={class:"materials-list"},Ve={class:"mat-name"},Ee={class:"mat-count"},Ue={class:"craft-cost"},je={class:"craft-warning"},Xe=["disabled"],Ze={key:1,class:"craft-card"},Ge={class:"craft-header"},He={class:"craft-title"},Je={class:"success-rate"},Ke={class:"materials-list"},Oe={class:"mat-name"},Qe={class:"mat-count"},We={class:"craft-cost"},Ye={class:"craft-warning severe"},es=["disabled"],ss={key:2,class:"complete-message"},as={class:"result-header"},ts={class:"result-message"},ns={key:0,class:"result-penalties"},ls={key:0,class:"penalty-item"},os=V({__name:"FlameFan",setup(h){const d=se(),f=te(),{status:t,loading:N}=E(f),_=k(!1),F=k(!1),b=k(!1),m=k(null),x=u=>u?u==="three_flame_fan"?"三焰扇":u==="seven_flame_fan"?"七焰扇":"未知":"未装备",B=u=>{if(u<=0)return"0秒";const s=Math.floor(u/(1e3*60*60)),y=Math.floor(u%(1e3*60*60)/(1e3*60)),i=Math.floor(u%(1e3*60)/1e3);return s>0?`${s}小时${y}分`:y>0?`${y}分${i}秒`:`${i}秒`},C=async u=>{_.value=!0;try{const s=await f.equip(u);d.success(s.message)}catch(s){d.error(s.response?.data?.message||"装备失败")}finally{_.value=!1}},P=async()=>{_.value=!0;try{const u=await f.unequip();d.success(u.message)}catch(u){d.error(u.response?.data?.message||"卸下失败")}finally{_.value=!1}},z=async u=>{F.value=!0;try{const s=await f.craft(u);m.value=s,b.value=!0,s.crafted?d.success(s.message):d.warning(s.message)}catch(s){d.error(s.response?.data?.message||"炼制失败")}finally{F.value=!1}};return U(async()=>{await f.fetchStatus(!0)}),(u,s)=>{const y=X;return l(),o("div",ne,[e("div",le,[e("div",oe,[n(a(g),{size:28})]),s[6]||(s[6]=e("div",{class:"header-info"},[e("h2",null,"七焰扇"),e("p",null,"上古火系至宝")],-1))]),a(N)?(l(),o("div",ie,[n(a(H),{size:32,class:"spin"}),s[7]||(s[7]=e("p",null,"加载中...",-1))])):a(t)?(l(),o(p,{key:2},[e("div",ue,[e("div",de,[s[9]||(s[9]=e("h3",null,"装备状态",-1)),a(t).combatPower>0?(l(),o("div",ce,[n(a(K),{size:16}),e("span",null,"战力 +"+r(a(t).combatPower.toLocaleString()),1)])):c("",!0)]),e("div",fe,[e("div",pe,[e("div",{class:v(["slot-icon",{active:a(t).equippedFlameFan}])},[n(a(g),{size:32})],2),e("div",me,[s[10]||(s[10]=e("span",{class:"slot-label"},"当前装备",-1)),e("span",{class:v(["slot-value",{equipped:a(t).equippedFlameFan}])},r(x(a(t).equippedFlameFan)),3)])]),a(t).fireResonance.hasResonance?(l(),o("div",ve,[n(a(O),{size:16}),e("span",{class:v(["resonance-type",a(t).fireResonance.type])},r(a(t).fireResonance.type==="full"?"完全共鸣":"部分共鸣"),3),e("span",he,"伤害 +"+r(a(t).fireResonance.bonusPercent)+"%",1)])):c("",!0)]),a(t).hasThreeFlameFan||a(t).hasSevenFlameFan?(l(),o("div",_e,[a(t).hasSevenFlameFan?(l(),o(p,{key:0},[a(t).equippedFlameFan!=="seven_flame_fan"?(l(),o("button",{key:0,class:"equip-btn legendary",onClick:s[0]||(s[0]=i=>C("seven_flame_fan")),disabled:_.value}," 装备七焰扇 ",8,Fe)):c("",!0)],64)):c("",!0),a(t).hasThreeFlameFan?(l(),o(p,{key:1},[a(t).equippedFlameFan!=="three_flame_fan"?(l(),o("button",{key:0,class:"equip-btn epic",onClick:s[1]||(s[1]=i=>C("three_flame_fan")),disabled:_.value}," 装备三焰扇 ",8,ge)):c("",!0)],64)):c("",!0),a(t).equippedFlameFan?(l(),o("button",{key:2,class:"unequip-btn",onClick:P,disabled:_.value}," 卸下装备 ",8,ye)):c("",!0)])):c("",!0)]),a(t).debuff?(l(),o("div",be,[e("div",we,[n(a(q),{size:18}),s[11]||(s[11]=e("span",null,"炼器反噬",-1))]),e("p",ke,r(a(t).debuff.description),1),e("div",qe,[e("span",null,"修炼效率 -"+r(a(t).debuff.cultivationReduction)+"%",1),e("span",null,"战力 -"+r(a(t).debuff.combatPowerReduction)+"%",1)]),e("div",Se,[n(a(Q),{size:14}),e("span",null,"剩余 "+r(B(a(t).debuff.remainingMs)),1)])])):c("",!0),e("div",Ce,[s[20]||(s[20]=e("h3",null,"法宝列表",-1)),e("div",ze,[e("div",{class:v(["fan-card epic",{owned:a(t).hasThreeFlameFan}])},[e("div",Re,[e("div",Te,[n(a(g),{size:24})]),s[12]||(s[12]=e("div",null,[e("h4",null,"三焰扇"),e("span",{class:"quality-tag epic"},"地品")],-1))]),s[15]||(s[15]=e("p",{class:"fan-desc"},"古法炼制的火系法宝仿品，战力+11,800",-1)),e("div",Ie,[a(t).hasThreeFlameFan?(l(),o(p,{key:0},[n(a(I),{size:14}),s[13]||(s[13]=e("span",null,"已拥有",-1))],64)):(l(),o(p,{key:1},[n(a(S),{size:14}),s[14]||(s[14]=e("span",null,"未拥有",-1))],64))])],2),e("div",{class:v(["fan-card legendary",{owned:a(t).hasSevenFlameFan}])},[e("div",Le,[e("div",$e,[n(a(g),{size:24})]),s[16]||(s[16]=e("div",null,[e("h4",null,"七焰扇"),e("span",{class:"quality-tag legendary"},"天品")],-1))]),s[19]||(s[19]=e("p",{class:"fan-desc"},"上古火系至宝，战力+35,000，火灵根共鸣+50%伤害",-1)),e("div",Me,[a(t).hasSevenFlameFan?(l(),o(p,{key:0},[n(a(I),{size:14}),s[17]||(s[17]=e("span",null,"已拥有",-1))],64)):(l(),o(p,{key:1},[n(a(S),{size:14}),s[18]||(s[18]=e("span",null,"未拥有",-1))],64))])],2)])]),e("div",Ne,[s[29]||(s[29]=e("h3",null,"炼器工坊",-1)),a(t).hasThreeFlameFan?c("",!0):(l(),o("div",xe,[e("div",Be,[e("div",Pe,[n(a(g),{size:20}),s[21]||(s[21]=e("h4",null,"炼制三焰扇",-1)),s[22]||(s[22]=e("span",{class:"quality-tag epic"},"地品",-1))]),e("div",Ae,[n(a(L),{size:14}),e("span",null,"成功率 "+r(a(t).craftInfo.threeFlameFan.successRate)+"%",1)])]),e("div",De,[(l(!0),o(p,null,R(a(t).craftInfo.threeFlameFan.materials,i=>(l(),o("div",{key:i.itemId,class:v(["material-item",{enough:i.owned>=i.required}])},[e("span",Ve,r(i.name),1),e("span",Ee,r(i.owned)+"/"+r(i.required),1)],2))),128))]),e("div",Ue,[n(a($),{size:14}),e("span",null,"消耗 "+r(a(t).craftInfo.threeFlameFan.spiritStoneCost.toLocaleString())+" 灵石",1)]),e("div",je,[n(a(q),{size:14}),s[23]||(s[23]=e("span",null,"失败将损失全部材料、5%修为，30%概率获得火焰反噬debuff",-1))]),e("button",{class:"craft-btn epic",onClick:s[2]||(s[2]=i=>z("three_flame_fan")),disabled:!a(t).craftInfo.threeFlameFan.canCraft||F.value},[n(a(M),{size:16}),T(" "+r(F.value?"炼制中...":a(t).craftInfo.threeFlameFan.reason||"开始炼制"),1)],8,Xe)])),a(t).hasThreeFlameFan&&!a(t).hasSevenFlameFan?(l(),o("div",Ze,[e("div",Ge,[e("div",He,[n(a(g),{size:20}),s[24]||(s[24]=e("h4",null,"炼制七焰扇",-1)),s[25]||(s[25]=e("span",{class:"quality-tag legendary"},"天品",-1))]),e("div",Je,[n(a(L),{size:14}),e("span",null,"成功率 "+r(a(t).craftInfo.sevenFlameFan.successRate)+"%",1)])]),e("div",Ke,[(l(!0),o(p,null,R(a(t).craftInfo.sevenFlameFan.materials,i=>(l(),o("div",{key:i.itemId,class:v(["material-item",{enough:i.owned>=i.required}])},[e("span",Oe,r(i.name),1),e("span",Qe,r(i.owned)+"/"+r(i.required),1)],2))),128))]),e("div",We,[n(a($),{size:14}),e("span",null,"消耗 "+r(a(t).craftInfo.sevenFlameFan.spiritStoneCost.toLocaleString())+" 灵石",1)]),e("div",Ye,[n(a(q),{size:14}),s[26]||(s[26]=e("span",null,"失败将损失三焰扇和全部材料、10%修为，60%概率获得严重debuff",-1))]),e("button",{class:"craft-btn legendary",onClick:s[3]||(s[3]=i=>z("seven_flame_fan")),disabled:!a(t).craftInfo.sevenFlameFan.canCraft||F.value},[n(a(M),{size:16}),T(" "+r(F.value?"炼制中...":a(t).craftInfo.sevenFlameFan.reason||"开始炼制"),1)],8,es)])):c("",!0),a(t).hasSevenFlameFan?(l(),o("div",ss,[n(a(W),{size:48}),s[27]||(s[27]=e("h4",null,"恭喜！你已拥有上古至宝【七焰扇】",-1)),s[28]||(s[28]=e("p",null,"天下火系法宝，无出其右",-1))])):c("",!0)])],64)):(l(),o("div",re,[n(a(J),{size:32}),s[8]||(s[8]=e("p",null,"加载失败",-1))])),n(y,{show:b.value,"onUpdate:show":s[5]||(s[5]=i=>b.value=i),"mask-closable":!0},{default:j(()=>[e("div",{class:v(["result-modal",{success:m.value?.crafted}])},[e("div",as,[(l(),Z(G(m.value?.crafted?a(Y):a(S)),{size:48})),e("h2",null,r(m.value?.itemName),1)]),e("p",ts,r(m.value?.message),1),m.value?.penalties?(l(),o("div",ns,[m.value.penalties.cultivationLost>0?(l(),o("div",ls,[n(a(ee),{size:14}),e("span",null,"损失修为："+r(m.value.penalties.cultivationLost.toLocaleString()),1)])):c("",!0)])):c("",!0),e("button",{class:"close-result-btn",onClick:s[4]||(s[4]=i=>b.value=!1)},"确定")],2)]),_:1},8,["show"])])}}}),Ss=ae(os,[["__scopeId","data-v-acbebcb6"]]);export{Ss as default};
