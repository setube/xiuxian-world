import{a2 as ks,bH as R,k as Cs,e as V,bx as j,f as P,N as $,c as r,a as s,p as T,d as l,g as t,Z as e,s as L,l as C,j as O,o as a,S as ns,a0 as zs,F as B,q as N,bv as J,m as ss,n as X,an as Rs,bG as xs,X as Ps,bz as Y,a1 as Ms}from"./index-DA11XDlS.js";import{F as vs}from"./flag-CeDOnItD.js";import{T as ms}from"./trending-up-BXfb3B-f.js";import{L as D}from"./loader-circle-BnoPFgCr.js";import{c as os}from"./createLucideIcon-DiiZaxVK.js";import{C as Ts}from"./crown-CTywvOnR.js";import{T as Bs}from"./triangle-alert-vQJa5xBQ.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{F as q}from"./flame-DuW_991e.js";import{G as I}from"./ghost-ebrS4p_g.js";import{X as ps}from"./x-DGyACQy4.js";import{S as us}from"./sparkles-tsZM6BNv.js";import{L as hs}from"./lock-CWZIQcVF.js";import{P as Fs}from"./plus-BY3P3rBe.js";import{C as fs}from"./clock-Bnzg_83l.js";import{S as Ns}from"./shield-BMlq6Nq0.js";import{P as A}from"./package-CRVIogFf.js";import{Z as _s}from"./zap-vMqaBpWc.js";import{S as ls}from"./skull-BAbr3491.js";import{R as cs}from"./refresh-cw-5h0-qbhL.js";import{S as Q}from"./swords-bfqjVPqN.js";import{A as Ls}from"./arrow-right-DS-hLDue.js";import{I as Os}from"./info-qMNw81gd.js";import{T as Gs}from"./trophy-B8Qqs7MA.js";import{F as Is}from"./frown-DdlGX0TI.js";const Es=os("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);const ys=os("trees",[["path",{d:"M10 10v.2A3 3 0 0 1 8.9 16H5a3 3 0 0 1-1-5.8V10a3 3 0 0 1 6 0Z",key:"1l6gj6"}],["path",{d:"M7 16v6",key:"1a82de"}],["path",{d:"M13 19v3",key:"13sx9i"}],["path",{d:"M12 19h8.3a1 1 0 0 0 .7-1.7L18 14h.3a1 1 0 0 0 .7-1.7L16 9h.2a1 1 0 0 0 .8-1.7L13 3l-1.4 1.5",key:"1sj9kv"}]]);const As=os("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]),Z=ks("bloodSoulBanner",{state:()=>({bannerStatus:null,shaPoolStatus:null,soulStorage:null,refinementSlots:[],bloodForestStatus:null,shadowSummonStatus:null,bannerUnlocked:!1,loading:!1,error:null,lastRefresh:0}),getters:{isUnlocked(){return this.bannerUnlocked},bannerLevel(){return this.bannerStatus?.level??0},currentSha(){return this.shaPoolStatus?.current??0},maxSha(){return this.shaPoolStatus?.max??100},canSacrifice(){return this.shaPoolStatus?.canSacrifice??!1},canRaidForest(){return this.bloodForestStatus?.canRaid??!1},canSummon(){return this.shadowSummonStatus?.canSummon??!1},availableSlots(){return this.refinementSlots.filter(n=>n.status==="empty").length},refiningSlots(){return this.refinementSlots.filter(n=>n.status==="refining").length},collectableSlots(){return this.refinementSlots.filter(n=>n.canCollect).length},totalSouls(){return this.soulStorage?.souls?Object.values(this.soulStorage.souls).reduce((n,i)=>n+i.count,0):0}},actions:{async fetchBannerStatus(n=!1){if(!(!n&&Date.now()-this.lastRefresh<5e3)){this.loading=!0,this.error=null;try{const i=await R.getStatus();this.bannerStatus=i.data,this.bannerUnlocked=!0,this.lastRefresh=Date.now()}catch(i){i.response?.data?.code===30201?(this.bannerUnlocked=!1,this.error=null):this.error=Cs(i,"获取血魂幡状态失败")}finally{this.loading=!1}}},async upgradeBanner(){this.loading=!0;try{const i=(await R.upgrade()).data;return await this.fetchBannerStatus(!0),i}finally{this.loading=!1}},async fetchShaPoolStatus(){try{const n=await R.getShaPoolStatus();this.shaPoolStatus=n.data}catch(n){console.error("获取煞气池状态失败:",n)}},async dailySacrifice(){this.loading=!0;try{const i=(await R.dailySacrifice()).data;return await this.fetchShaPoolStatus(),i}finally{this.loading=!1}},async convertCultivation(n){this.loading=!0;try{const u=(await R.convertCultivation(n)).data;return await this.fetchShaPoolStatus(),u}finally{this.loading=!1}},async fetchSoulStorage(){try{const n=await R.getSoulStorage();this.soulStorage=n.data}catch(n){console.error("获取魂魄储备失败:",n)}},async fetchRefinementSlots(){try{const n=await R.getRefinementSlots();this.refinementSlots=n.data}catch(n){console.error("获取炼化槽失败:",n)}},async startRefinement(n,i){this.loading=!0;try{const y=(await R.startRefinement(n,i)).data;return await this.fetchRefinementSlots(),await this.fetchSoulStorage(),await this.fetchShaPoolStatus(),y}finally{this.loading=!1}},async maintainSlot(n){this.loading=!0;try{const u=(await R.maintainSlot(n)).data;return await this.fetchRefinementSlots(),await this.fetchShaPoolStatus(),u}finally{this.loading=!1}},async collectRefinement(n){this.loading=!0;try{const u=(await R.collectRefinement(n)).data;return await this.fetchRefinementSlots(),u}finally{this.loading=!1}},async fetchBloodForestStatus(){try{const n=await R.getBloodForestStatus();this.bloodForestStatus=n.data}catch(n){console.error("获取血洗山林状态失败:",n)}},async raidBloodForest(){this.loading=!0;try{const i=(await R.raidBloodForest()).data;return await this.fetchBloodForestStatus(),await this.fetchShaPoolStatus(),await this.fetchSoulStorage(),i}finally{this.loading=!1}},async fetchShadowSummonStatus(){try{const n=await R.getShadowSummonStatus();this.shadowSummonStatus=n.data}catch(n){console.error("获取召唤魔影状态失败:",n)}},async summonShadow(){this.loading=!0;try{const i=(await R.summonShadow()).data;return await this.fetchShadowSummonStatus(),await this.fetchSoulStorage(),i}finally{this.loading=!1}},async refreshAll(n=!1){if(!(!n&&Date.now()-this.lastRefresh<5e3)){this.loading=!0;try{await Promise.all([this.fetchBannerStatus(n),this.fetchShaPoolStatus(),this.fetchSoulStorage(),this.fetchRefinementSlots(),this.fetchBloodForestStatus(),this.fetchShadowSummonStatus()]),this.lastRefresh=Date.now()}finally{this.loading=!1}}}}}),ts={1:{slots:1,maxSoulGrade:1,upgradeCost:0},2:{slots:1,maxSoulGrade:1,upgradeCost:500},3:{slots:2,maxSoulGrade:2,upgradeCost:1e3},4:{slots:2,maxSoulGrade:2,upgradeCost:2e3},5:{slots:3,maxSoulGrade:3,upgradeCost:4e3},6:{slots:3,maxSoulGrade:3,upgradeCost:8e3},7:{slots:4,maxSoulGrade:4,upgradeCost:15e3},8:{slots:4,maxSoulGrade:4,upgradeCost:25e3},9:{slots:5,maxSoulGrade:4,upgradeCost:4e4},10:{slots:5,maxSoulGrade:4,upgradeCost:6e4}},Us=10,es={grievance_soul:{id:"grievance_soul",name:"怨魂",grade:1,refineTimeMs:1800*1e3,shaCost:20,obtainMethod:"PvP胜利20%几率",primaryOutput:"阴魂丝 1-3",rareOutput:"凝血草",rareChance:15},cultivator_remnant:{id:"cultivator_remnant",name:"修士残魂",grade:2,refineTimeMs:3600*1e3,shaCost:40,obtainMethod:"PvP胜利10%几率",primaryOutput:"二级妖丹 1-2",rareOutput:"养魂木",rareChance:20},beast_spirit:{id:"beast_spirit",name:"妖兽精魄",grade:3,refineTimeMs:7200*1e3,shaCost:80,obtainMethod:"血洗山林",primaryOutput:"三级妖丹 1-2",rareOutput:"清灵草",rareChance:25},fierce_soul:{id:"fierce_soul",name:"凶兽戾魄",grade:4,refineTimeMs:14400*1e3,shaCost:150,obtainMethod:"召唤魔影",primaryOutput:"四级妖丹 1",rareOutput:"法则碎片·暗",rareChance:10}},M={dailySacrifice:{baseSha:10,killCountBonus:.5,maxBonus:50},cultivationToSha:{ratio:5,dailyLimit:100},pvpShaGain:{min:50,max:100},maxShaEnergy:100,shaEnergyBonus:.5,killCountBonus:.1,maxKillCountBonus:50},G={minRealm:2,dailyLimit:5,shaCost:30,realmName:"筑基期"},E={minRealm:3,dailyLimit:3,sacrificeItemName:"三级妖丹",sacrificeQuantity:5,realmName:"结丹期"};function as(n){const i=Math.floor(n/36e5),u=Math.floor(n%(3600*1e3)/(60*1e3));return i>0?u>0?`${i}小时${u}分钟`:`${i}小时`:`${u}分钟`}function is(n){return{1:"#a8a8a8",2:"#4ade80",3:"#60a5fa",4:"#c084fc"}[n]||"#a8a8a8"}function rs(n){return{1:"凡品",2:"良品",3:"上品",4:"极品"}[n]||"未知"}function Ss(n){return n>=70?"#4ade80":n>=40?"#fbbf24":n>=20?"#f97316":"#ef4444"}const Ds={class:"banner-status-card"},qs={class:"banner-display"},Vs={class:"banner-visual"},js={class:"banner-icon"},Hs={class:"banner-level"},Zs={class:"banner-info"},Xs={class:"info-row"},Qs={class:"value level"},Ws={class:"info-row"},Ks={class:"value"},Ys={class:"info-row"},Js={class:"info-row"},st={key:0,class:"upgrade-section"},tt={class:"upgrade-info"},et={class:"upgrade-title"},at={class:"upgrade-cost"},nt={class:"upgrade-benefits"},ot={key:0},lt={key:1},it=["disabled"],rt={key:1,class:"max-level"},dt={key:2,class:"stability-warning"},ut=V({__name:"BannerStatusCard",setup(n){const i=Z(),{bannerStatus:u}=j(i),y=P(!1),m=$(()=>{const z=u.value?.level||1;return ts[z]}),o=$(()=>{const z=u.value?.level||1;return ts[z+1]}),_=$(()=>(u.value?.level||1)<Us),S=$(()=>o.value?.upgradeCost||0),f=$(()=>!0);async function w(){if(!(y.value||!_.value)){y.value=!0;try{await i.upgradeBanner()}finally{y.value=!1}}}return(z,g)=>(a(),r("div",Ds,[s("div",qs,[s("div",Vs,[g[0]||(g[0]=s("div",{class:"banner-glow"},null,-1)),s("div",js,[l(t(vs),{size:40})]),s("div",Hs,e(t(u)?.level||1),1)]),s("div",Zs,[s("div",Xs,[g[1]||(g[1]=s("span",{class:"label"},"血魂幡等阶",-1)),s("span",Qs,"第"+e(t(u)?.level||1)+"阶",1)]),s("div",Ws,[g[2]||(g[2]=s("span",{class:"label"},"炼化槽位",-1)),s("span",Ks,e(m.value?.slots||1)+"个",1)]),s("div",Ys,[g[3]||(g[3]=s("span",{class:"label"},"可炼化等级",-1)),s("span",{class:"value",style:L({color:t(is)(m.value?.maxSoulGrade||1)})},e(t(rs)(m.value?.maxSoulGrade||1)),5)]),s("div",Js,[g[4]||(g[4]=s("span",{class:"label"},"稳定度",-1)),s("span",{class:"value",style:L({color:t(Ss)(t(u)?.stability||100)})},e(t(u)?.stability||100)+"% ",5)])])]),_.value?(a(),r("div",st,[s("div",tt,[s("div",et,[l(t(ms),{size:16}),s("span",null,"升级至第"+e((t(u)?.level||1)+1)+"阶",1)]),s("div",at,"消耗阴魂丝: "+e(S.value),1),s("div",nt,[o.value&&o.value.slots>(m.value?.slots||1)?(a(),r("span",ot,"+1炼化槽")):T("",!0),o.value&&o.value.maxSoulGrade>(m.value?.maxSoulGrade||1)?(a(),r("span",lt,"可炼化更高级魂魄")):T("",!0)])]),s("button",{class:"upgrade-btn",disabled:y.value||!f.value,onClick:w},[y.value?(a(),C(t(D),{key:0,size:16,class:"spin"})):(a(),C(t(Es),{key:1,size:16})),O(" "+e(y.value?"升级中...":"升级"),1)],8,it)])):(a(),r("div",rt,[l(t(Ts),{size:18}),g[5]||(g[5]=s("span",null,"血魂幡已达最高等阶",-1))])),(t(u)?.stability||100)<40?(a(),r("div",dt,[l(t(Bs),{size:16}),g[6]||(g[6]=s("span",null,"稳定度过低，炼化产出将减半！请及时安抚幡灵",-1))])):T("",!0)]))}}),ct=H(ut,[["__scopeId","data-v-4d15de15"]]),vt={class:"refinement-slots"},mt={class:"panel-header"},pt={class:"slot-count"},ht={class:"slots-container"},ft={key:0,class:"slot-locked"},_t=["onClick"],yt={key:2,class:"slot-refining"},St={class:"refining-header"},gt={class:"soul-name"},bt={class:"refining-progress"},$t={class:"progress-bar"},wt={class:"progress-time"},kt={class:"refining-stability"},Ct={class:"stability-label"},zt=["disabled","onClick"],Rt={key:3,class:"slot-complete"},xt={class:"complete-icon"},Pt={class:"soul-name"},Mt=["disabled","onClick"],Tt={class:"modal-header"},Bt={class:"modal-body"},Ft={key:0,class:"no-souls"},Nt={key:1,class:"soul-select-list"},Lt=["onClick"],Ot={class:"soul-info"},Gt={class:"soul-header"},It={class:"soul-name"},Et={class:"soul-details"},At={class:"soul-count"},Ut={key:0,class:"soul-locked-hint"},Dt={class:"result-header"},qt={class:"result-rewards"},Vt={class:"reward-count"},jt=V({__name:"RefinementSlots",setup(n){const i=Z(),{bannerStatus:u,refinementSlots:y,soulStorage:m}=j(i),o=P(!1),_=P(!1),S=P(0),f=P(!1),w=P([]);let z=null;const g=$(()=>{const v=u.value?.level||1;return ts[v]?.slots||1}),U=$(()=>y.value?.filter(v=>v.status!=="empty").length||0),d=$(()=>{const v=u.value?.level||1;return ts[v]?.maxSoulGrade||1}),F=$(()=>{const v=[];for(let c=0;c<5;c++)if(c>=g.value)v.push({locked:!0,status:"empty",soulType:null,progress:0,remainingMs:0,stability:100});else{const x=y.value?.[c];v.push({locked:!1,status:x?.status||"empty",soulType:x?.soulType||null,progress:x?.progress||0,remainingMs:x?.remainingMs||0,stability:x?.stability||100})}return v}),W=$(()=>Object.values(es).filter(v=>(m.value?.souls[v.id]?.count||0)>0).map(v=>({id:v.id,name:v.name,grade:v.grade,gradeName:rs(v.grade),color:is(v.grade),refineTime:as(v.refineTimeMs),shaCost:v.shaCost,count:m.value?.souls[v.id]?.count||0})));function K(v){return v&&es[v]?.name||"未知"}function k(v){return v.grade<=d.value}function h(v){return v.progress}function b(v){return as(v.remainingMs)}function gs(v){S.value=v,o.value=!0}async function bs(v){if(!f.value){f.value=!0;try{await i.startRefinement(S.value,v.id),o.value=!1}finally{f.value=!1}}}async function $s(v){if(!f.value){f.value=!0;try{await i.maintainSlot(v)}finally{f.value=!1}}}async function ws(v){if(!f.value){f.value=!0;try{const p=await i.collectRefinement(v);p.outputs&&p.outputs.length>0&&(w.value=p.outputs.map(c=>({name:c.itemName,quantity:c.quantity})),_.value=!0)}finally{f.value=!1}}}return ns(()=>{i.fetchRefinementSlots(),i.fetchSoulStorage(),z=setInterval(()=>{i.fetchRefinementSlots()},3e4)}),zs(()=>{z&&clearInterval(z)}),(v,p)=>(a(),r("div",vt,[s("div",mt,[l(t(q),{size:20}),p[6]||(p[6]=s("span",null,"炼化槽",-1)),s("span",pt,e(U.value)+"/"+e(g.value),1)]),s("div",ht,[(a(!0),r(B,null,N(F.value,(c,x)=>(a(),r("div",{key:x,class:X(["slot-card",{locked:c.locked,empty:!c.locked&&c.status==="empty",refining:c.status==="refining",complete:c.status==="complete"}])},[c.locked?(a(),r("div",ft,[l(t(hs),{size:24}),p[7]||(p[7]=s("span",null,"升级血魂幡解锁",-1))])):c.status==="empty"?(a(),r("div",{key:1,class:"slot-empty",onClick:ds=>gs(x)},[l(t(Fs),{size:32}),p[8]||(p[8]=s("span",null,"囚禁魂魄",-1))],8,_t)):c.status==="refining"?(a(),r("div",yt,[s("div",St,[l(t(I),{size:20}),s("span",gt,e(K(c.soulType)),1)]),s("div",bt,[s("div",$t,[s("div",{class:"progress-fill",style:L({width:h(c)+"%"})},null,4)]),s("div",wt,[l(t(fs),{size:14}),s("span",null,e(b(c)),1)])]),s("div",kt,[s("div",Ct,[l(t(Ns),{size:14}),p[9]||(p[9]=s("span",null,"稳定度",-1))]),s("div",{class:"stability-value",style:L({color:t(Ss)(c.stability)})},e(c.stability)+"%",5),s("button",{class:"maintain-btn",disabled:f.value,onClick:ds=>$s(x)},[l(t(As),{size:14}),p[10]||(p[10]=O(" 安抚 ",-1))],8,zt)])])):c.status==="complete"?(a(),r("div",Rt,[s("div",xt,[l(t(us),{size:32})]),s("span",Pt,e(K(c.soulType)),1),s("button",{class:"collect-btn",disabled:f.value,onClick:ds=>ws(x)},[l(t(A),{size:16}),p[11]||(p[11]=O(" 收取精华 ",-1))],8,Mt)])):T("",!0)],2))),128))]),(a(),C(ss,{to:"body"},[o.value?(a(),r("div",{key:0,class:"modal-overlay",onClick:p[2]||(p[2]=c=>o.value=!1)},[s("div",{class:"modal-content",onClick:p[1]||(p[1]=J(()=>{},["stop"]))},[s("div",Tt,[l(t(I),{size:20}),p[12]||(p[12]=s("span",null,"选择魂魄",-1)),s("button",{class:"close-btn",onClick:p[0]||(p[0]=c=>o.value=!1)},[l(t(ps),{size:20})])]),s("div",Bt,[W.value.length===0?(a(),r("div",Ft,[l(t(I),{size:40}),p[13]||(p[13]=s("span",null,"暂无可用魂魄",-1)),p[14]||(p[14]=s("span",{class:"hint"},"通过PvP或PvE活动获取魂魄",-1))])):(a(),r("div",Nt,[(a(!0),r(B,null,N(W.value,c=>(a(),r("div",{key:c.id,class:X(["soul-select-item",{disabled:!k(c)}]),onClick:x=>k(c)&&bs(c)},[s("div",{class:"soul-icon",style:L({color:c.color})},[l(t(I),{size:24})],4),s("div",Ot,[s("div",Gt,[s("span",It,e(c.name),1),s("span",{class:"soul-grade",style:L({color:c.color})},e(c.gradeName),5)]),s("div",Et,[s("span",null,"炼化: "+e(c.refineTime),1),s("span",null,"煞气: "+e(c.shaCost),1)])]),s("div",At,"×"+e(c.count),1),k(c)?T("",!0):(a(),r("div",Ut,"等级不足"))],10,Lt))),128))]))])])])):T("",!0)])),(a(),C(ss,{to:"body"},[_.value?(a(),r("div",{key:0,class:"modal-overlay",onClick:p[5]||(p[5]=c=>_.value=!1)},[s("div",{class:"result-modal",onClick:p[4]||(p[4]=J(()=>{},["stop"]))},[s("div",Dt,[l(t(us),{size:24}),p[15]||(p[15]=s("span",null,"炼化完成!",-1))]),s("div",qt,[(a(!0),r(B,null,N(w.value,(c,x)=>(a(),r("div",{key:x,class:"reward-item"},[l(t(A),{size:16}),s("span",null,e(c.name),1),s("span",Vt,"×"+e(c.quantity),1)]))),128))]),s("button",{class:"result-btn",onClick:p[3]||(p[3]=c=>_.value=!1)},"确定")])])):T("",!0)]))]))}}),Ht=H(jt,[["__scopeId","data-v-10af6609"]]),Zt={class:"sha-pool-panel"},Xt={class:"sha-status-card"},Qt={class:"sha-header"},Wt={class:"sha-display"},Kt={class:"sha-ring"},Yt={viewBox:"0 0 100 100"},Jt=["stroke-dasharray"],se={class:"sha-center"},te={class:"sha-number"},ee={class:"sha-info"},ae={class:"info-row"},ne={class:"value"},oe={class:"info-row"},le={class:"value bonus"},ie={class:"info-row"},re={class:"value kill-bonus"},de={class:"acquisition-section"},ue={class:"section-title"},ce={class:"acquisition-card"},ve={class:"card-icon sacrifice"},me={class:"card-info"},pe={class:"card-desc"},he=["disabled"],fe={key:1},_e={class:"acquisition-card"},ye={class:"card-icon convert"},Se={class:"card-info"},ge={class:"card-desc"},be=["disabled"],$e={class:"acquisition-card pvp-tip"},we={class:"card-icon pvp"},ke={class:"card-info"},Ce={class:"card-desc"},ze={class:"pvp-hint"},Re={class:"modal-header"},xe={class:"modal-body"},Pe={class:"convert-info"},Me={class:"info-item"},Te={class:"value"},Be={class:"info-item"},Fe={class:"value"},Ne={class:"info-item"},Le={class:"value"},Oe={class:"convert-input"},Ge={class:"input-wrapper"},Ie=["max"],Ee={class:"convert-preview"},Ae={class:"modal-footer"},Ue=["disabled"],De={key:1},qe=V({__name:"ShaPoolPanel",setup(n){const i=Z(),{shaPoolStatus:u}=j(i),y=P(!1),m=P(10),o=P(null),_=$(()=>u.value?u.value.current/u.value.max*100:0),S=$(()=>u.value?.canSacrifice??!0),f=$(()=>M.cultivationToSha.dailyLimit-(u.value?.dailyConverted||0)>0),w=$(()=>M.cultivationToSha.dailyLimit-(u.value?.dailyConverted||0));async function z(){if(!(o.value||!S.value)){o.value="sacrifice";try{await i.dailySacrifice()}finally{o.value=null}}}async function g(){if(!(o.value||m.value<=0)){o.value="convert";try{await i.convertCultivation(m.value),y.value=!1}finally{o.value=null}}}return(U,d)=>(a(),r("div",Zt,[s("div",Xt,[s("div",Qt,[l(t(q),{size:20}),d[7]||(d[7]=s("span",null,"煞气池",-1))]),s("div",Wt,[s("div",Kt,[(a(),r("svg",Yt,[d[8]||(d[8]=s("circle",{class:"ring-bg",cx:"50",cy:"50",r:"42"},null,-1)),s("circle",{class:"ring-progress",cx:"50",cy:"50",r:"42","stroke-dasharray":`${_.value*2.64} 264`},null,8,Jt)])),s("div",se,[l(t(_s),{size:24}),s("span",te,e(t(u)?.current||0),1)])]),s("div",ee,[s("div",ae,[d[9]||(d[9]=s("span",{class:"label"},"当前煞气",-1)),s("span",ne,e(t(u)?.current||0)+"/"+e(t(u)?.max||100),1)]),s("div",oe,[d[10]||(d[10]=s("span",{class:"label"},"战力加成",-1)),s("span",le,"+"+e((t(u)?.bonusPercent||0).toFixed(1))+"%",1)]),s("div",ie,[d[11]||(d[11]=s("span",{class:"label"},"杀戮值加成",-1)),s("span",re,"+"+e((t(u)?.killCountBonus||0).toFixed(1))+"%",1)])])])]),s("div",de,[s("div",ue,[l(t(ms),{size:18}),d[12]||(d[12]=s("span",null,"煞气获取",-1))]),s("div",ce,[s("div",ve,[l(t(ls),{size:20})]),s("div",me,[d[13]||(d[13]=s("div",{class:"card-title"},"每日献祭",-1)),s("div",pe," 获得 "+e(t(M).dailySacrifice.baseSha)+" + 杀戮值×"+e(t(M).dailySacrifice.killCountBonus)+" 煞气 ",1)]),s("button",{class:"action-btn",disabled:o.value!==null||!S.value,onClick:z},[o.value==="sacrifice"?(a(),C(t(D),{key:0,size:16,class:"spin"})):(a(),r("span",fe,e(S.value?"献祭":"已献祭"),1))],8,he)]),s("div",_e,[s("div",ye,[l(t(cs),{size:20})]),s("div",Se,[d[14]||(d[14]=s("div",{class:"card-title"},"化功为煞",-1)),s("div",ge,e(t(M).cultivationToSha.ratio)+"修为 = 1煞气 (今日"+e(t(u)?.dailyConverted||0)+"/"+e(t(M).cultivationToSha.dailyLimit)+") ",1)]),s("button",{class:"action-btn",disabled:o.value!==null||!f.value,onClick:d[0]||(d[0]=F=>y.value=!0)}," 转换 ",8,be)]),s("div",$e,[s("div",we,[l(t(Q),{size:20})]),s("div",ke,[d[15]||(d[15]=s("div",{class:"card-title"},"PvP胜利",-1)),s("div",Ce," 击败敌人获得 "+e(t(M).pvpShaGain.min)+"-"+e(t(M).pvpShaGain.max)+" 煞气 ",1)]),s("div",ze,[l(t(Ls),{size:16}),d[16]||(d[16]=s("span",null,"前往煞气淬体",-1))])])]),(a(),C(ss,{to:"body"},[y.value?(a(),r("div",{key:0,class:"modal-overlay",onClick:d[6]||(d[6]=F=>y.value=!1)},[s("div",{class:"modal-content",onClick:d[5]||(d[5]=J(()=>{},["stop"]))},[s("div",Re,[l(t(cs),{size:20}),d[17]||(d[17]=s("span",null,"化功为煞",-1)),s("button",{class:"close-btn",onClick:d[1]||(d[1]=F=>y.value=!1)},[l(t(ps),{size:20})])]),s("div",xe,[s("div",Pe,[s("div",Me,[d[18]||(d[18]=s("span",{class:"label"},"转换比例",-1)),s("span",Te,e(t(M).cultivationToSha.ratio)+"修为 = 1煞气",1)]),s("div",Be,[d[19]||(d[19]=s("span",{class:"label"},"今日已转换",-1)),s("span",Fe,e(t(u)?.dailyConverted||0)+"/"+e(t(M).cultivationToSha.dailyLimit),1)]),s("div",Ne,[d[20]||(d[20]=s("span",{class:"label"},"可转换上限",-1)),s("span",Le,e(w.value)+" 煞气",1)])]),s("div",Oe,[d[21]||(d[21]=s("label",null,"转换煞气数量",-1)),s("div",Ge,[Rs(s("input",{type:"number","onUpdate:modelValue":d[2]||(d[2]=F=>m.value=F),min:1,max:w.value,placeholder:"输入数量"},null,8,Ie),[[xs,m.value,void 0,{number:!0}]]),s("button",{class:"max-btn",onClick:d[3]||(d[3]=F=>m.value=w.value)},"最大")]),s("div",Ee," 消耗修为: "+e(m.value*t(M).cultivationToSha.ratio),1)])]),s("div",Ae,[s("button",{class:"cancel-btn",onClick:d[4]||(d[4]=F=>y.value=!1)},"取消"),s("button",{class:"confirm-btn",disabled:o.value!==null||m.value<=0,onClick:g},[o.value==="convert"?(a(),C(t(D),{key:0,size:16,class:"spin"})):(a(),r("span",De,"确认转换"))],8,Ue)])])])):T("",!0)]))]))}}),Ve=H(qe,[["__scopeId","data-v-fa216f16"]]),je={class:"soul-storage-panel"},He={class:"panel-header"},Ze={class:"soul-list"},Xe={class:"soul-icon"},Qe={class:"soul-info"},We={class:"soul-header"},Ke={class:"soul-name"},Ye={class:"soul-details"},Je={class:"detail-item"},sa={class:"detail-item"},ta={class:"soul-outputs"},ea={class:"output-primary"},aa={class:"output-rare"},na={class:"count-number"},oa={class:"obtain-section"},la={class:"section-title"},ia={class:"obtain-list"},ra={class:"obtain-item"},da={class:"obtain-item"},ua={class:"obtain-item"},ca={class:"obtain-item"},va=V({__name:"SoulStoragePanel",setup(n){const i=Z(),{soulStorage:u}=j(i),y=$(()=>Object.values(es).map(m=>({id:m.id,name:m.name,grade:m.grade,gradeName:rs(m.grade),color:is(m.grade),refineTime:as(m.refineTimeMs),shaCost:m.shaCost,primaryOutput:m.primaryOutput,rareOutput:m.rareOutput,rareChance:m.rareChance,count:u.value?.souls[m.id]?.count||0})));return(m,o)=>(a(),r("div",je,[s("div",He,[l(t(I),{size:20}),o[0]||(o[0]=s("span",null,"魂魄储备",-1))]),s("div",Ze,[(a(!0),r(B,null,N(y.value,_=>(a(),r("div",{key:_.id,class:"soul-card",style:L({"--soul-color":_.color})},[s("div",Xe,[l(t(I),{size:24})]),s("div",Qe,[s("div",We,[s("span",Ke,e(_.name),1),s("span",{class:"soul-grade",style:L({color:_.color})},e(_.gradeName),5)]),s("div",Ye,[s("div",Je,[l(t(fs),{size:12}),s("span",null,"炼化时间: "+e(_.refineTime),1)]),s("div",sa,[l(t(q),{size:12}),s("span",null,"消耗煞气: "+e(_.shaCost),1)])]),s("div",ta,[s("span",ea,e(_.primaryOutput),1),s("span",aa,e(_.rareOutput)+" ("+e(_.rareChance)+"%)",1)])]),s("div",{class:X(["soul-count",{"has-souls":_.count>0}])},[s("span",na,e(_.count),1),o[1]||(o[1]=s("span",{class:"count-label"},"个",-1))],2)],4))),128))]),s("div",oa,[s("div",la,[l(t(Os),{size:16}),o[2]||(o[2]=s("span",null,"获取途径",-1))]),s("div",ia,[s("div",ra,[l(t(Q),{size:14}),o[3]||(o[3]=s("span",null,[s("strong",null,"怨魂"),O(" : PvP胜利 20%几率 ")],-1))]),s("div",da,[l(t(Q),{size:14}),o[4]||(o[4]=s("span",null,[s("strong",null,"修士残魂"),O(" : PvP胜利 10%几率 ")],-1))]),s("div",ua,[l(t(ys),{size:14}),o[5]||(o[5]=s("span",null,[s("strong",null,"妖兽精魄"),O(" : 血洗山林 ")],-1))]),s("div",ca,[l(t(ls),{size:14}),o[6]||(o[6]=s("span",null,[s("strong",null,"凶兽戾魄"),O(" : 召唤魔影 ")],-1))])])])]))}}),ma=H(va,[["__scopeId","data-v-33713256"]]),pa={class:"pve-panel"},ha={class:"pve-section blood-forest"},fa={class:"section-header"},_a={class:"header-icon forest"},ya={class:"header-info"},Sa={class:"section-content"},ga={class:"status-row"},ba={class:"status-item"},$a={class:"value"},wa={class:"status-item"},ka={class:"value cost"},Ca={class:"enemy-list"},za={class:"enemy-title"},Ra={class:"enemy-grid"},xa={class:"enemy-name"},Pa={class:"enemy-power"},Ma={class:"output-info"},Ta=["disabled"],Ba={class:"pve-section shadow-summon"},Fa={class:"section-header"},Na={class:"header-icon shadow"},La={class:"header-info"},Oa={class:"section-content"},Ga={class:"status-row"},Ia={class:"status-item"},Ea={class:"value"},Aa={class:"status-item"},Ua={class:"value cost"},Da={class:"boss-list"},qa={class:"boss-title"},Va={class:"boss-grid"},ja={class:"boss-name"},Ha={class:"boss-power"},Za={class:"boss-reward"},Xa={class:"output-info"},Qa=["disabled"],Wa={class:"result-header"},Ka={class:"result-title"},Ya={class:"result-enemy"},Ja={key:0,class:"result-rewards"},sn={key:0,class:"reward-item"},tn={class:"reward-count"},en={class:"reward-count"},an={class:"reward-count"},nn={key:1,class:"result-loss"},on=V({__name:"PvEPanel",setup(n){const i=Z(),u=Ps(),{bloodForestStatus:y,shadowSummonStatus:m}=j(i),o=P(null),_=P(!1),S=P(null),f=$(()=>o.value!==null),w=[{id:"blood_wolf",name:"血煞妖狼",powerMultiplier:.8},{id:"red_snake",name:"赤目魔蛇",powerMultiplier:.9},{id:"soul_crow",name:"噬魂阴鸦",powerMultiplier:1},{id:"blood_tiger",name:"血骨妖虎",powerMultiplier:1.1}],z=[{id:"blood_rakshasa",name:"血狱罗刹",powerMultiplier:1.5,rewards:{spiritStones:500}},{id:"netherworld_king",name:"九幽冥王",powerMultiplier:2,rewards:{spiritStones:800}},{id:"demon_lord",name:"天魔尊者",powerMultiplier:2.5,rewards:{spiritStones:1200}}],g=$(()=>!((u.character?.realm?.tier||0)<G.minRealm||(y.value?.dailyRemaining||0)<=0||(i.shaPoolStatus?.current||0)<G.shaCost)),U=$(()=>!((u.character?.realm?.tier||0)<E.minRealm||(m.value?.dailyRemaining||0)<=0||!m.value?.hasSacrifice)),d=$(()=>o.value==="forest"?"战斗中...":(u.character?.realm?.tier||0)<G.minRealm?"境界不足":(y.value?.dailyRemaining||0)<=0?"今日已用尽":(i.shaPoolStatus?.current||0)<G.shaCost?"煞气不足":"血洗山林"),F=$(()=>o.value==="shadow"?"召唤中...":(u.character?.realm?.tier||0)<E.minRealm?"境界不足":(m.value?.dailyRemaining||0)<=0?"今日已用尽":m.value?.hasSacrifice?"召唤魔影":"祭品不足");async function W(){if(!(f.value||!g.value)){o.value="forest";try{const k=await i.raidBloodForest();S.value={victory:k.victory,enemyName:k.enemy.name,rewards:k.rewards},_.value=!0}finally{o.value=null}}}async function K(){if(!(f.value||!U.value)){o.value="shadow";try{const k=await i.summonShadow();S.value={victory:k.victory,enemyName:k.boss.name,rewards:k.rewards},_.value=!0}finally{o.value=null}}}return ns(()=>{i.fetchBloodForestStatus(),i.fetchShadowSummonStatus()}),(k,h)=>(a(),r("div",pa,[s("div",ha,[s("div",fa,[s("div",_a,[l(t(ys),{size:20})]),s("div",ya,[h[3]||(h[3]=s("h3",null,"血洗山林",-1)),s("p",null,e(t(G).realmName)+"解锁 · 狩猎妖兽获取精魄",1)])]),s("div",Sa,[s("div",ga,[s("div",ba,[h[4]||(h[4]=s("span",{class:"label"},"今日次数",-1)),s("span",$a,e(t(G).dailyLimit-(t(y)?.dailyRemaining||0))+"/"+e(t(G).dailyLimit),1)]),s("div",wa,[h[5]||(h[5]=s("span",{class:"label"},"消耗煞气",-1)),s("span",ka,e(t(G).shaCost),1)])]),s("div",Ca,[s("div",za,[l(t(ls),{size:14}),h[6]||(h[6]=s("span",null,"可遇敌怪",-1))]),s("div",Ra,[(a(),r(B,null,N(w,b=>s("div",{key:b.id,class:"enemy-card"},[s("span",xa,e(b.name),1),s("span",Pa,"战力×"+e(b.powerMultiplier),1)])),64))])]),s("div",Ma,[l(t(A),{size:14}),h[7]||(h[7]=s("span",null,"产出: 妖兽精魄 + 阴魂丝 + 凝血草",-1))]),s("button",{class:"action-btn forest-btn",disabled:!g.value||f.value,onClick:W},[o.value==="forest"?(a(),C(t(D),{key:0,size:16,class:"spin"})):(a(),C(t(Q),{key:1,size:16})),O(" "+e(d.value),1)],8,Ta)])]),s("div",Ba,[s("div",Fa,[s("div",Na,[l(t(I),{size:20})]),s("div",La,[h[8]||(h[8]=s("h3",null,"召唤魔影",-1)),s("p",null,e(t(E).realmName)+"解锁 · 献祭妖丹召唤魔影",1)])]),s("div",Oa,[s("div",Ga,[s("div",Ia,[h[9]||(h[9]=s("span",{class:"label"},"今日次数",-1)),s("span",Ea,e(t(E).dailyLimit-(t(m)?.dailyRemaining||0))+"/"+e(t(E).dailyLimit),1)]),s("div",Aa,[h[10]||(h[10]=s("span",{class:"label"},"祭品消耗",-1)),s("span",Ua,e(t(E).sacrificeItemName)+" ×"+e(t(E).sacrificeQuantity),1)])]),s("div",Da,[s("div",qa,[l(t(q),{size:14}),h[11]||(h[11]=s("span",null,"可召魔影",-1))]),s("div",Va,[(a(),r(B,null,N(z,b=>s("div",{key:b.id,class:"boss-card"},[s("span",ja,e(b.name),1),s("span",Ha,"战力×"+e(b.powerMultiplier),1),s("span",Za,"灵石 +"+e(b.rewards.spiritStones),1)])),64))])]),s("div",Xa,[l(t(A),{size:14}),h[12]||(h[12]=s("span",null,"产出: 凶兽戾魄 + 四级妖丹 + 阴魂丝",-1))]),s("button",{class:"action-btn shadow-btn",disabled:!U.value||f.value,onClick:K},[o.value==="shadow"?(a(),C(t(D),{key:0,size:16,class:"spin"})):(a(),C(t(_s),{key:1,size:16})),O(" "+e(F.value),1)],8,Qa)])]),(a(),C(ss,{to:"body"},[_.value?(a(),r("div",{key:0,class:"modal-overlay",onClick:h[2]||(h[2]=b=>_.value=!1)},[s("div",{class:X(["battle-result-modal",{win:S.value?.victory,lose:!S.value?.victory}]),onClick:h[1]||(h[1]=J(()=>{},["stop"]))},[s("div",Wa,[S.value?.victory?(a(),C(t(Gs),{key:0,size:40})):(a(),C(t(Is),{key:1,size:40}))]),s("div",Ka,e(S.value?.victory?"战斗胜利!":"战斗失败"),1),s("div",Ya,e(S.value?.enemyName),1),S.value?.victory&&S.value?.rewards?(a(),r("div",Ja,[S.value.rewards.spiritStones>0?(a(),r("div",sn,[l(t(A),{size:14}),h[13]||(h[13]=s("span",null,"灵石",-1)),s("span",tn,"+"+e(S.value.rewards.spiritStones),1)])):T("",!0),(a(!0),r(B,null,N(S.value.rewards.souls,b=>(a(),r("div",{key:b.type,class:"reward-item"},[l(t(A),{size:14}),s("span",null,e(b.name),1),s("span",en,"×"+e(b.count),1)]))),128)),(a(!0),r(B,null,N(S.value.rewards.materials,b=>(a(),r("div",{key:b.itemId,class:"reward-item"},[l(t(A),{size:14}),s("span",null,e(b.name),1),s("span",an,"×"+e(b.count),1)]))),128))])):(a(),r("div",nn,[...h[14]||(h[14]=[s("span",null,"未能战胜对手，请提升实力后再来!",-1)])])),s("button",{class:"result-btn",onClick:h[0]||(h[0]=b=>_.value=!1)},"确定")],2)])):T("",!0)]))]))}}),ln=H(on,[["__scopeId","data-v-81f40e5e"]]),rn={class:"blood-soul-banner"},dn={class:"soul-particles"},un={class:"page-header"},cn={class:"header-icon"},vn={key:0,class:"loading-container"},mn={key:1,class:"not-unlocked"},pn={class:"tab-container"},hn=["onClick"],fn={key:0,class:"tab-content"},_n={key:1,class:"tab-content"},yn={key:2,class:"tab-content"},Sn={key:3,class:"tab-content"},gn=V({__name:"BloodSoulBannerPage",setup(n){const i=Z(),{loading:u,bannerStatus:y,isUnlocked:m}=j(i),o=P("refine"),_=[{id:"refine",name:"炼化槽",icon:Y(q)},{id:"sha",name:"煞气池",icon:Y(q)},{id:"souls",name:"魂魄储备",icon:Y(I)},{id:"pve",name:"PvE活动",icon:Y(Q)}];return ns(async()=>{try{await i.fetchBannerStatus()}catch(S){console.error("初始化血魂幡系统失败:",S)}}),(S,f)=>(a(),r("div",rn,[s("div",dn,[(a(),r(B,null,N(30,w=>s("div",{key:w,class:"soul-particle",style:L({"--delay":Math.random()*5+"s","--x":Math.random()*100+"%","--y":Math.random()*100+"%","--size":Math.random()*6+3+"px","--duration":Math.random()*4+3+"s"})},null,4)),64))]),s("div",un,[s("div",cn,[f[0]||(f[0]=s("div",{class:"header-icon-glow"},null,-1)),f[1]||(f[1]=s("div",{class:"header-icon-ring"},null,-1)),l(t(vs),{size:24})]),f[2]||(f[2]=s("div",{class:"header-text"},[s("h1",null,"血魂幡"),s("p",null,"本命魔宝 · 炼魂为宝")],-1))]),t(u)&&!t(y)?(a(),r("div",vn,[l(t(D),{size:32,class:"spin"}),f[3]||(f[3]=s("span",null,"正在唤醒魔宝...",-1))])):t(m)?(a(),r(B,{key:2},[l(ct),s("div",pn,[(a(),r(B,null,N(_,w=>s("div",{key:w.id,class:X(["tab-item",{active:o.value===w.id}]),onClick:z=>o.value=w.id},[(a(),C(Ms(w.icon),{size:18})),s("span",null,e(w.name),1)],10,hn)),64))]),o.value==="refine"?(a(),r("div",fn,[l(Ht)])):o.value==="sha"?(a(),r("div",_n,[l(Ve)])):o.value==="souls"?(a(),r("div",yn,[l(ma)])):o.value==="pve"?(a(),r("div",Sn,[l(ln)])):T("",!0)],64)):(a(),r("div",mn,[l(t(hs),{size:48}),f[4]||(f[4]=s("h2",null,"血魂幡未激活",-1)),f[5]||(f[5]=s("p",null,"筑基期后，黑煞教弟子可激活本命魔宝",-1))]))]))}}),Hn=H(gn,[["__scopeId","data-v-2f408b2f"]]);export{Hn as default};
